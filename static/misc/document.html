<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>document</title><style type="text/css"> * {margin:0; padding:0; text-indent:0; }
 h1 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 14pt; }
 .s1 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; }
 .s2 { color: black; font-family:"Times New Roman", serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 12pt; }
 h2 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 12pt; }
 .p, p { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 10pt; margin:0pt; }
 .s3 { color: black; font-family:"Times New Roman", serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 10pt; }
 .s4 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 10pt; }
 h3 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 10pt; }
 .s5 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 .s6 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 .s7 { color: black; font-family:"Courier New", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 10pt; }
 h4 { color: #005F00; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 .s8 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 .s9 { color: black; font-family:"Courier New", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 .s10 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt; }
 .s11 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 10pt; }
 .s12 { color: #0046AB; font-family:"Lucida Grande", sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 10pt; }
 .s13 { color: #004485; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 6.5pt; }
 .s14 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5.5pt; }
 .s15 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6pt; }
 .s16 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; vertical-align: 1pt; }
 .s17 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .s18 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .a, a { color: black; font-family:"Courier New", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .s19 { color: black; font-family:"Courier New", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .s20 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6pt; }
 .s21 { color: black; font-family:"Times New Roman", serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .s22 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6pt; }
 .s23 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 li {display: block; }
 #l1 {padding-left: 0pt;counter-reset: c1 1; }
 #l1> li>*:first-child:before {counter-increment: c1; content: counter(c1, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 12pt; }
 #l1> li:first-child>*:first-child:before {counter-increment: c1 0;  }
 #l2 {padding-left: 0pt;counter-reset: c2 1; }
 #l2> li>*:first-child:before {counter-increment: c2; content: counter(c1, decimal)"."counter(c2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 12pt; }
 #l2> li:first-child>*:first-child:before {counter-increment: c2 0;  }
 #l3 {padding-left: 0pt;counter-reset: d1 1; }
 #l3> li>*:first-child:before {counter-increment: d1; content: counter(d1, upper-latin)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l3> li:first-child>*:first-child:before {counter-increment: d1 0;  }
 #l4 {padding-left: 0pt;counter-reset: d2 1; }
 #l4> li>*:first-child:before {counter-increment: d2; content: counter(d1, upper-latin)"."counter(d2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l4> li:first-child>*:first-child:before {counter-increment: d2 0;  }
 #l5 {padding-left: 0pt;counter-reset: e1 2; }
 #l5> li>*:first-child:before {counter-increment: e1; content: counter(e1, upper-latin)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l5> li:first-child>*:first-child:before {counter-increment: e1 0;  }
 #l6 {padding-left: 0pt;counter-reset: e2 13; }
 #l6> li>*:first-child:before {counter-increment: e2; content: counter(e1, upper-latin)"."counter(e2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l6> li:first-child>*:first-child:before {counter-increment: e2 0;  }
 #l7 {padding-left: 0pt;counter-reset: f1 2; }
 #l7> li>*:first-child:before {counter-increment: f1; content: counter(f1, upper-latin)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l7> li:first-child>*:first-child:before {counter-increment: f1 0;  }
 #l8 {padding-left: 0pt;counter-reset: f2 23; }
 #l8> li>*:first-child:before {counter-increment: f2; content: counter(f1, upper-latin)"."counter(f2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l8> li:first-child>*:first-child:before {counter-increment: f2 0;  }
 #l9 {padding-left: 0pt;counter-reset: g1 3; }
 #l9> li>*:first-child:before {counter-increment: g1; content: counter(g1, upper-latin)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l9> li:first-child>*:first-child:before {counter-increment: g1 0;  }
 #l10 {padding-left: 0pt;counter-reset: g2 1; }
 #l10> li>*:first-child:before {counter-increment: g2; content: counter(g1, upper-latin)"."counter(g2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l10> li:first-child>*:first-child:before {counter-increment: g2 0;  }
 #l11 {padding-left: 0pt;counter-reset: h1 4; }
 #l11> li>*:first-child:before {counter-increment: h1; content: counter(h1, upper-latin)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l11> li:first-child>*:first-child:before {counter-increment: h1 0;  }
 #l12 {padding-left: 0pt;counter-reset: h2 6; }
 #l12> li>*:first-child:before {counter-increment: h2; content: counter(h1, upper-latin)"."counter(h2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l12> li:first-child>*:first-child:before {counter-increment: h2 0;  }
 #l13 {padding-left: 0pt;counter-reset: i1 5; }
 #l13> li>*:first-child:before {counter-increment: i1; content: counter(i1, upper-latin)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l13> li:first-child>*:first-child:before {counter-increment: i1 0;  }
 #l14 {padding-left: 0pt;counter-reset: i2 1; }
 #l14> li>*:first-child:before {counter-increment: i2; content: counter(i1, upper-latin)"."counter(i2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l14> li:first-child>*:first-child:before {counter-increment: i2 0;  }
 #l15 {padding-left: 0pt;counter-reset: c2 1; }
 #l15> li>*:first-child:before {counter-increment: c2; content: counter(c1, decimal)"."counter(c2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 12pt; }
 #l15> li:first-child>*:first-child:before {counter-increment: c2 0;  }
 li {display: block; }
 #l16 {padding-left: 0pt;counter-reset: j1 1; }
 #l16> li>*:first-child:before {counter-increment: j1; content: "["counter(j1, decimal)"] "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 #l16> li:first-child>*:first-child:before {counter-increment: j1 0;  }
 #l17 {padding-left: 0pt;counter-reset: k1 3; }
 #l17> li>*:first-child:before {counter-increment: k1; content: counter(k1, upper-latin)". "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7pt; }
 #l17> li:first-child>*:first-child:before {counter-increment: k1 0;  }
 li {display: block; }
 #l18 {padding-left: 0pt;counter-reset: l1 1; }
 #l18> li>*:first-child:before {counter-increment: l1; content: counter(l1, upper-latin)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 12pt; }
 #l18> li:first-child>*:first-child:before {counter-increment: l1 0;  }
 #l19 {padding-left: 0pt;counter-reset: l2 1; }
 #l19> li>*:first-child:before {counter-increment: l2; content: counter(l1, upper-latin)"."counter(l2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l19> li:first-child>*:first-child:before {counter-increment: l2 0;  }
 li {display: block; }
 #l20 {padding-left: 0pt;counter-reset: m1 2; }
 #l20> li>*:first-child:before {counter-increment: m1; content: counter(m1, upper-latin)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l20> li:first-child>*:first-child:before {counter-increment: m1 0;  }
 #l21 {padding-left: 0pt;counter-reset: m2 1; }
 #l21> li>*:first-child:before {counter-increment: m2; content: counter(m1, upper-latin)"."counter(m2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l21> li:first-child>*:first-child:before {counter-increment: m2 0;  }
 li {display: block; }
 #l22 {padding-left: 0pt;counter-reset: k1 3; }
 #l22> li>*:first-child:before {counter-increment: k1; content: counter(k1, upper-latin)". "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7pt; }
 #l22> li:first-child>*:first-child:before {counter-increment: k1 0;  }
 #l23 {padding-left: 0pt;counter-reset: k2 1; }
 #l23> li>*:first-child:before {counter-increment: k2; content: counter(k1, upper-latin)"."counter(k2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l23> li:first-child>*:first-child:before {counter-increment: k2 0;  }
 li {display: block; }
 #l24 {padding-left: 0pt;counter-reset: n1 4; }
 #l24> li>*:first-child:before {counter-increment: n1; content: counter(n1, upper-latin)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l24> li:first-child>*:first-child:before {counter-increment: n1 0;  }
 #l25 {padding-left: 0pt;counter-reset: n2 1; }
 #l25> li>*:first-child:before {counter-increment: n2; content: counter(n1, upper-latin)"."counter(n2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l25> li:first-child>*:first-child:before {counter-increment: n2 0;  }
 li {display: block; }
 #l26 {padding-left: 0pt;counter-reset: o1 5; }
 #l26> li>*:first-child:before {counter-increment: o1; content: counter(o1, upper-latin)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l26> li:first-child>*:first-child:before {counter-increment: o1 0;  }
 #l27 {padding-left: 0pt;counter-reset: o2 1; }
 #l27> li>*:first-child:before {counter-increment: o2; content: counter(o1, upper-latin)"."counter(o2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l27> li:first-child>*:first-child:before {counter-increment: o2 0;  }
 li {display: block; }
 #l28 {padding-left: 0pt;counter-reset: p1 6; }
 #l28> li>*:first-child:before {counter-increment: p1; content: counter(p1, upper-latin)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l28> li:first-child>*:first-child:before {counter-increment: p1 0;  }
 #l29 {padding-left: 0pt;counter-reset: p2 1; }
 #l29> li>*:first-child:before {counter-increment: p2; content: counter(p1, upper-latin)"."counter(p2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l29> li:first-child>*:first-child:before {counter-increment: p2 0;  }
 table, tbody {vertical-align: top; overflow: visible; }
</style></head><body><h1 style="padding-top: 4pt;text-indent: 0pt;text-align: center;">Needles in a Haystack:</h1><h1 style="padding-top: 1pt;padding-left: 83pt;text-indent: 0pt;line-height: 111%;text-align: center;">Mining Information from Public Dynamic Analysis Sandboxes for Malware Intelligence</h1><p style="padding-top: 8pt;text-indent: 0pt;text-align: left;"><br/></p><p class="s1" style="padding-top: 4pt;padding-left: 69pt;text-indent: 0pt;text-align: center;">Mariano Graziano</p><p class="s2" style="padding-left: 69pt;text-indent: 0pt;text-align: center;">Eurecom</p><p class="s1" style="padding-top: 4pt;padding-left: 31pt;text-indent: 0pt;text-align: center;">Davide Canali</p><p class="s2" style="padding-left: 31pt;text-indent: 0pt;text-align: center;">Eurecom</p><p class="s1" style="padding-top: 4pt;text-indent: 0pt;text-align: center;">Leyla Bilge</p><p class="s2" style="text-indent: 0pt;text-align: center;">Symantec Research Labs</p><p class="s1" style="padding-top: 6pt;padding-left: 99pt;text-indent: 0pt;text-align: center;">Andrea Lanzi</p><p class="s2" style="padding-left: 99pt;text-indent: 0pt;text-align: center;">Universita’ degli Studi di Milano</p><p style="padding-top: 2pt;text-indent: 0pt;text-align: left;"><br/></p><h2 style="text-indent: 0pt;text-align: center;">Abstract</h2><p class="s1" style="padding-top: 6pt;text-indent: 0pt;text-align: center;">Davide Balzarotti</p><p class="s2" style="text-indent: 0pt;text-align: center;">Eurecom</p><p style="padding-top: 4pt;text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;">The main advantage of these systems is the fact that</p><p style="padding-top: 6pt;padding-left: 6pt;text-indent: 9pt;text-align: justify;">Malware sandboxes are automated dynamic analysis systems that execute programs in a controlled environ- ment. Within the large volumes of samples submitted every day to these services, some submissions appear to be different from others, and show interesting character- istics. For example, we observed that malware samples involved in famous targeted attacks – like the Regin APT framework or the recently disclosed malwares from the Equation Group – were submitted to our sandbox months or even years before they were detected in the wild. In other cases, the malware developers themselves interact with public sandboxes to test their creations or to develop a new evasion technique. We refer to similar cases as <i>malware developments</i>.</p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;">In this paper, we propose a novel methodology to au- tomatically identify <i>malware development </i>cases from the samples submitted to a malware analysis sandbox. The results of our experiments show that, by combining dy- namic and static analysis with features based on the file submission, it is possible to achieve a good accuracy in automatically identifying cases of <i>malware development</i>. Our goal is to raise awareness on this problem and on the importance of looking at these samples from an intelli- gence and threat prevention point of view.</p><p style="padding-top: 7pt;text-indent: 0pt;text-align: left;"><br/></p><ol id="l1"><li data-list-text="1"><h2 style="padding-left: 23pt;text-indent: -17pt;text-align: left;"><a name="bookmark0">&zwnj;</a>Introduction</h2><p style="padding-top: 11pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;"><a href="#bookmark35" class="s4">Malware sandboxes are automated dynamic analysis tools that execute samples in an isolated and instru- mented environment. Security researchers use them to quickly collect information about the behavior of suspi- cious samples, typically in terms of their execution traces and API calls. While customized sandboxes are often installed in the premises of security companies, some sandboxes are available as public online services, as it is the case for Malwr [</a><a href="#bookmark32" class="s4">13], Anubis [</a><a href="#bookmark36" class="s4">10], ThreatExpert [</a>14],</p><p style="padding-left: 6pt;text-indent: 0pt;line-height: 11pt;text-align: justify;"><a href="#bookmark38" class="s4">VirusTotal [</a><a href="#bookmark27" class="s4">16], and many others [</a><a href="#bookmark40" class="s4">5, </a><a href="#bookmark26" class="s4">18, </a><a href="#bookmark28" class="s4">4, </a><a href="#bookmark37" class="s4">6, </a><a href="#bookmark23" class="s4">15, </a><a href="#bookmark25" class="s4">1, </a>3]</p><p style="padding-left: 6pt;text-indent: 0pt;text-align: justify;">the analysis is completely automated and easily paral- lelizable, thus providing a way to cope with the over- whelming number of new samples that are collected ev- ery day. However, due to this extreme parallelization, an incredible amount of reports are generated every day. This makes the task of distinguishing new and important malware from the background noise of polymorphic and uninteresting samples very challenging.</p><p style="padding-top: 1pt;padding-left: 6pt;text-indent: 9pt;text-align: justify;"><a href="#bookmark47" class="s4">In particular, two important and distinct observations motivate our work. First, it is relatively common that malware samples used to carry out famous targeted at- tacks were collected by antivirus companies or public sandboxes long before the attacks were publicly dis- covered [</a><a href="#bookmark33" class="s4">25]. For instance, the binaries responsible for operation Aurora, Red October, Regin, and even some of the new one part of the Equation Group were sub- mitted to the sandbox we used in our experiments sev- eral months before the respective attacks appeared in the news [</a><a href="#bookmark62" class="s4">11, </a><a href="#bookmark39" class="s4">40, </a><a href="#bookmark72" class="s4">17, </a><a href="#bookmark67" class="s4">50, </a><a href="#bookmark57" class="s4">45, </a>35]. The reasons behind this phenomenon are not always clear. It is possible that the files were automatically collected as part of an automated network or host-based protection system. Or maybe a security analyst noticed something anomalous on a com- puter and wanted to double-check if a suspicious file ex- hibited a potentially malicious behavior. It is even pos- sible that the malware developers themselves submitted an early copy of their work to verify whether it triggered any alert on the sandbox system. Whatever the reason, the important point is that no one paid attention to those files until it was too late.</p><p style="padding-top: 1pt;padding-left: 6pt;text-indent: 9pt;text-align: justify;"><a href="#bookmark41" class="s4">The second observation motivating our study is the constant arm race between the researchers that put con- tinuous effort to randomize their analysis environments, and the criminals that try to fingerprint those systems to avoid being detected. As a consequence of this hid- den battle, malware and packers often include evasion techniques for popular sandboxes [</a>19] and updated in- formation about the internal sandbox details are regu-</p><p style="padding-top: 3pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;"><a href="#bookmark24" class="s4">larly posted on public websites [</a>2].  These examples prove that there must be a constant interaction between malware developers and popular public malware analysis services. This interaction is driven by the need to collect updated information as well as to make sure that new malware creation would go undetected. Even though de- tecting this interaction might be very difficult, we be- lieve it would provide valuable information for malware triage.</p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;"><a href="#bookmark45" class="s4">Up to the present, malware analysis services have col- lected large volumes of data. This data has been used both to enhance analysis techniques [</a><a href="#bookmark68" class="s4">23, </a><a href="#bookmark46" class="s4">46] and to ex- trapolate trends and statistics about the evolution of mal- ware families [</a><a href="#bookmark74" class="s4">24]. Unfortunately, to the best of our knowledge, these datasets have never been used to sys- tematically study malware development and support mal- ware intelligence on a large scale. The only public excep- tion is a research recently conducted by looking at Virus- Total to track the activity of specific high-profile hacking groups involved in APT campaigns [</a><a href="#bookmark49" class="s4">52, </a>27].</p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;"><a href="#bookmark32" class="s4">In this paper, we approach this objective by applying data-mining and machine learning techniques to study the data collected by Anubis Sandbox [</a>10], a popular malware dynamic analysis service. At the time we per- formed our analysis, the dataset contained the analysis reports for over 30 millions unique samples. Our main goal is to automatically detect if miscreants submit their samples during the malware development phase and, if this is the case, to acquire more insights about the dy- namics of malware development. By analyzing the meta- data associated to the sample submissions, it might be possible to determine the software provenance and im- plement an early-warning system to flag suspicious sub- mission behaviors.</p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;">It is important to understand that our objective is not to develop a full-fledged system, but instead to explore a new direction and to show that by combining metadata with static and dynamic features it is possible to suc- cessfully detect many examples of malware development submitted to public sandboxes. In fact, our simple pro- totype was able to automatically identify thousands of development cases, including botnets, keyloggers, back- doors, and over a thousand unique trojan applications.</p><p style="padding-top: 4pt;text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="2"><h2 style="padding-left: 23pt;text-indent: -17pt;text-align: left;"><a name="bookmark1">&zwnj;</a>Overview and Terminology</h2><p style="padding-top: 10pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;">There are several reasons why criminals may want to in- teract with an online malware sandbox. It could be just for curiosity, in order to better understand the analysis environment and estimate its capabilities. Another rea- son could be to try to escape from the sandbox isolation to perform some malicious activity, such as scanning a network or attacking another machine. Finally, criminals may also want to submit samples for testing purposes,</p><p style="padding-top: 3pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;">to make sure that a certain evasion technique works as expected in the sandbox environment, or that a certain malware prototype does not raise any alarm.</p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;">In this paper, we focus on the detection of what we call <i>malware development</i>. We use the term <i>“development” </i><a href="#bookmark15" class="s4">in a broad sense, to include anything that is submitted by the author of the file itself. In many cases the author has access to the source code of the program – either because she wrote it herself or because she acquired it from some- one else. However, this is not always the case, e.g., when the author of a sample uses a builder tool to automatically generate a binary according to a number of optional con- figurations (see Section </a>6 for a practical example of this scenario). Moreover, to keep things simple, we also use the word <i>“malware” </i>as a generic term to model any sus- picious program. This definition includes traditional ma- licious samples, but also attack tools, packers, and small probes written with the only goal of exfiltrating informa- tion about the sandbox internals.</p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;">Our main goal is to automatically detect suspicious submissions that are likely related to malware develop- ment or to a misuse of the public sandbox. We also want to use the collected information for malware intelligence. In this context, <i>intelligence </i>means a process, supported by data analysis, that helps an analyst to infer the moti- vation, intent, and possibly the identity of the attacker.</p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;">Our analysis consists of five different phases. In the first phase, we filter out the samples that are not inter- esting for our analysis. Since the rest of the analysis is quite time-consuming, any sample that cannot be related to malware development or that we cannot process with our current prototype is discarded at this phase. In the second phase, we cluster the remaining samples based on their binary similarity. Samples in each cluster are then compared using a more fine-grained static analysis technique. Afterwards, we collect six sets of features, based respectively on static characteristics of the submit- ted files, on the results of the dynamic execution of the samples in the cluster, and on the metadata associated to the samples submissions. This features are finally pro- vided to a classifier that we previously trained to identify the <i>malware development </i>clusters.</p><p style="padding-top: 4pt;text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="3"><h2 style="padding-left: 23pt;text-indent: -17pt;text-align: left;"><a name="bookmark2">&zwnj;</a>Data reduction</h2><p style="padding-top: 10pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;">The first phase of our study has the objective of reducing the amount of data by filtering out all the samples that are not relevant for our analysis. We assume that a cer- tain file could be a candidate for malware development only if two conditions are met. First, the sample must have been submitted to the public sandbox <i>before </i>it was observed in the wild. Second, it has to be part of a <i>man- ual </i>submission done by an individual user – and not, for example, originating from a batch submission of a secu-</p><p style="padding-top: 5pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;">rity company or from an automated malware collection or protection system.</p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;">We started by filtering out the large number of batch submissions Anubis Sandbox receives from several re- searchers, security labs, companies, universities and reg- istered users that regularly submit large bulks of binaries. As summarized in Table 1, with this step we managed to reduce the data from 32 million to around 6.6 million binaries. These samples have been collected by Anubis Sandbox from 2006 to 2013.</p><p style="padding-left: 5pt;text-indent: 9pt;text-align: justify;">Then, to isolate the new files that were never observed in the wild, we applied a two-step approach. First, we re- moved those submissions that, while performed by single users, were already part of a previous batch submission. This reduced the size of the dataset to half a million sam- ples. In the second step, we removed the files that were uploaded to the sandbox <i>after </i>they were observed by two very large external data sources: Symantec’s Worldwide Intelligence Network (WINE), and VirusTotal.</p><p style="padding-left: 5pt;text-indent: 9pt;text-align: justify;"><a href="#bookmark7" class="s4">After removing corrupted or not executable files (e.g, Linux binaries submitted to the Microsoft Windows sandbox), we remained with 184,548 files that match our initial definition of candidates for malware development. Before sending them to the following stages of our anal- ysis, we applied one more filter to remove the packed ap- plications. The rationale behind this choice is very sim- ple. As explained in Section </a><a href="#bookmark59" class="s4">4, the majority of our fea- tures work also on packed binaries, and, therefore, some potential malware development can be identified also in this category. However, it would be very hard for us to verify our results without having access to the decom- piled code of the application. Therefore, in this paper we decided to focus on unpacked binaries, for which it is possible to double-check the findings of our system. The packed executables were identified by leveraging the SigBuster [</a>37] signatures.</p><p style="padding-left: 5pt;text-indent: 9pt;text-align: justify;">Table 1 summarizes the number of binaries that are fil- tered out after each step. The filtering phase reduced the data to be analyzed from over 32 millions to just above 121,000 candidate files, submitted by a total of 68,250 distinct IP addresses. In the rest of this section we de- scribe in more details the nature and role of the Symantec and VirusTotal external sources.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h3 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Symantec Filter</h3><p style="padding-top: 8pt;padding-left: 5pt;text-indent: 0pt;text-align: justify;"><a href="#bookmark50" class="s4">Symantec Worldwide Intelligence Network Environment (WINE) is a platform that allows researchers to perform data intensive analysis on a wide range of cyber security relevant datasets, collected from over a hundred million hosts [</a>28]. The data provided by WINE is very valuable for the research community, because these hosts are com- puters that are actively used by real users which are po-</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:15.495pt" cellspacing="0"><tr style="height:17pt"><td style="width:146pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#CCCCCC"><p class="s5" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Dataset</p></td><td style="width:60pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#CCCCCC"><p class="s5" style="padding-right: 5pt;text-indent: 0pt;line-height: 10pt;text-align: right;">Submissions</p></td></tr><tr style="height:11pt"><td style="width:146pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s6" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Initial Dataset</p></td><td style="width:60pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s6" style="padding-right: 5pt;text-indent: 0pt;line-height: 10pt;text-align: right;">32,294,094</p></td></tr><tr style="height:11pt"><td style="width:146pt;border-left-style:solid;border-left-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s6" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Submitted by regular users</p></td><td style="width:60pt;border-left-style:solid;border-left-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s6" style="padding-right: 5pt;text-indent: 0pt;line-height: 10pt;text-align: right;">6,660,022</p></td></tr><tr style="height:11pt"><td style="width:146pt;border-left-style:solid;border-left-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s6" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Not already part of large submissions</p></td><td style="width:60pt;border-left-style:solid;border-left-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s6" style="padding-right: 5pt;text-indent: 0pt;line-height: 10pt;text-align: right;">522,699</p></td></tr><tr style="height:11pt"><td style="width:146pt;border-left-style:solid;border-left-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s6" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Previously unknown by Symantec</p></td><td style="width:60pt;border-left-style:solid;border-left-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s6" style="padding-right: 5pt;text-indent: 0pt;line-height: 10pt;text-align: right;">420,750</p></td></tr><tr style="height:11pt"><td style="width:146pt;border-left-style:solid;border-left-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s6" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Previously unknown by VirusTotal</p></td><td style="width:60pt;border-left-style:solid;border-left-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s6" style="padding-right: 5pt;text-indent: 0pt;line-height: 10pt;text-align: right;">214,321</p></td></tr><tr style="height:12pt"><td style="width:146pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s6" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Proper executable files</p></td><td style="width:60pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s6" style="padding-right: 5pt;text-indent: 0pt;line-height: 10pt;text-align: right;">184,548</p></td></tr><tr style="height:11pt"><td style="width:146pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s6" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Final (not packed binaries)</p></td><td style="width:60pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s6" style="padding-right: 5pt;text-indent: 0pt;line-height: 10pt;text-align: right;">121,856</p></td></tr></table><p style="padding-top: 6pt;text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 6pt;text-indent: 0pt;text-align: justify;">Table 1: Number of submissions present in our dataset at each data reduction step.</p><p style="padding-top: 9pt;text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 6pt;text-indent: 0pt;text-align: justify;">tential victims of various cyber threats. WINE adopts a 1:16 sampling on this large-scale data such that all types of complex experiments can be held at scale.</p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;">To filter out from our analysis the binaries that are not good candidates to belong to malware development, we used two WINE datasets: the binary reputation and the AntiVirus telemetry datasets. The binary reputation dataset contains information about all of the executables (both malicious and benign) downloaded by Symantec customers over a period of approximately 5 years. To preserve the user privacy, this data is collected only from the users that gave explicit consent for it. At the time we performed our study, the binary reputation dataset included reports for over 400 millions of distinct bina- ries. On the other hand, the AntiVirus telemetry dataset records only the detections of known files that triggered the Norton Antivirus Engine on the users’ machines.</p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;">The use of binary reputation helps us locating the exact point in time in which a binary was first disseminated in the wild. The AntiVirus telemetry data provided instead the first time the security company deployed a signature to detect the malware. We combined these datasets to remove those files that had already been observed by Symantec either before the submission to Anubis Sand- box, or within 24 hours from the time they were first sub- mitted to the sandbox.</p><p style="padding-top: 4pt;text-indent: 0pt;text-align: left;"><br/></p><h3 style="padding-left: 6pt;text-indent: 0pt;text-align: left;">VirusTotal Filter</h3><p style="padding-top: 7pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;">VirusTotal is a public service that provides virus scan re- sults and additional information about hundreds of mil- lions of analyzed files. In particular, it incorporates the detection results of over 50 different AntiVirus engines – thus providing a reliable estimation of whether a file is benign or malicious.  Please note that we fetched the VirusTotal results for each file in our dataset several months (and in some cases even years) after the file was first submitted. This ensures that the AV signatures were up to date, and files were not misclassified just because they belonged to a new or emerging malware family.</p><p style="padding-left: 15pt;text-indent: 0pt;text-align: justify;">Among all the information VirusTotal provides about</p><p style="padding-top: 3pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;">binaries, the most important piece of information we in- corporate in our study is the first submission time of a certain file to the service. We believe that by combining the timestamps obtained from the VirusTotal and Syman- tec datasets, we achieved an acceptable approximation of the first time a certain malicious file was observed in the wild.</p><p style="padding-top: 4pt;text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="4"><h2 style="padding-left: 23pt;text-indent: -17pt;text-align: left;"><a name="bookmark3">&zwnj;</a>Sample Analysis<a name="bookmark7">&zwnj;</a></h2><p style="padding-top: 10pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;">If a sample survived the data reduction phase, it means that (with a certain approximation due to the coverage of Symantec and Virustotal datasets) it had never been observed in the wild before it was submitted to the on- line malware analysis sandbox. Although this might be a good indicator, it is still not sufficient to flag the sub- mission as part of a potential malware development. In fact, there could be other possible explanations for this phenomenon, such as the fact that the binary was just a new metamorphic variation of an already known mal- ware family.</p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;">Therefore, to reduce the risk of mis-classification, in this paper we consider a candidate for possible develop- ment only when we can observe at least two samples that clearly show the changes introduced by the author in the software. In the rest of this section we describe how we find these groups of samples by clustering similar sub- missions together based on the sample similarity.</p><p style="padding-top: 3pt;text-indent: 0pt;text-align: left;"><br/></p><ol id="l2"><li data-list-text="4.1"><h2 style="padding-left: 32pt;text-indent: -26pt;text-align: left;"><a name="bookmark4">&zwnj;</a>Sample Clustering</h2><p style="padding-top: 6pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;"><a href="#bookmark53" class="s4">In the last decade, the problem of malware clustering has been widely studied and various solutions have been proposed [</a><a href="#bookmark55" class="s4">31, </a><a href="#bookmark73" class="s4">33, </a><a href="#bookmark54" class="s4">51, </a>32].  Existing approaches typi- cally use behavioral features to group together samples that likely belong to the same family, even when the binaries are quite different. Our work does not aim at proposing a new clustering method for malware. In fact, our goal is quite different and requires to group files to- gether only when they are very similar (we are looking for small changes between two versions of the same sam- ple) and not when they just belong to the same family. Therefore, we leverage a clustering algorithm that simply groups samples together based on their binary similarity (as computed by <i>ssdeep </i><a href="#bookmark60" class="s4">[</a>38]) and on a set of features we extract from the submission metadata.</p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;">Moreover, we decided to put together similar binaries into the same cluster only if they were submitted to our sandbox in a well defined time window. Again, the as- sumption is that when a malware author is working on a new program, the different samples would be submitted to the online sandbox in a short timeframe. Therefore, to cluster similar binaries we compute the binary similari- ties among all the samples submitted in a sliding window</p><p style="padding-top: 3pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;">of seven days. We then shift the sliding window ahead of one day and repeat this step. We employ this sliding window approach in order (1) to limit the complexity of the computation and the total number of binary compar- isons, and (2) to ensure that only the binaries that are similar and have been submitted within one week from each other are clustered together. We also experimented with other window sizes (between 2 and 15 days) but while we noticed a significant reduction of clusters for shorter thresholds, we did not observed any advantage in increasing it over one week.</p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;">Similarities among binaries are computed using the <i>ss- deep </i><a href="#bookmark60" class="s4">[</a>38] tool which is designed to detect similarities on binary data. <i>ssdeep </i>provides a light-weight solution for comparing a large-number of files by relying solely on similarity digests that can be easily stored in a database. As we already discarded packed binaries in the data re- duction phase, we are confident that the similarity score computed by <i>ssdeep </i>is a very reliable way to group to- gether binaries that share similar code snippets. After computing the similarity metrics, we executed a simple agglomerative clustering algorithm to group the binaries for which the similarity score is greater than 70%. Note that this step is executed separately for each time win- dow, but it preserves transitivity between binaries in dif- ferent sliding windows. For example, if file <i>A </i>is similar to <i>B </i>inside <i>window1</i>, and <i>B </i>is similar to file <i>C </i>inside the next sliding window, at the end of the process <i>A</i>, <i>B </i>and <i>C </i>will be grouped into the same cluster. As a result, a sin- gle cluster can model a malware development spanning also several months.</p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;">Starting from the initial number of binaries, we identi- fied 5972 clusters containing an average of 4.5 elements each.</p><p style="padding-top: 6pt;text-indent: 0pt;text-align: left;"><br/></p><h3 style="padding-left: 6pt;text-indent: 0pt;text-align: left;">Inter-Cluster Relationships</h3><p style="padding-top: 8pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;">The <i>ssdeep </i><a href="#bookmark60" class="s4">algorithm summarizes the similarity using an index between 0 (completely different) and 100 (perfect match). Our clustering algorithm groups together sam- ples for which the difference between the fuzzy hashes is greater than the 70% threshold. This threshold was chosen according to previous experiments [</a>38], which concluded that 70% similarity is enough to guarantee a probability of misclassification close to zero.</p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;">However, if the malware author makes very large changes on a new version of his program, our approach may not be able to find the association between the two versions. Moreover, the final version of a malware devel- opment could be compiled with different options, mak- ing a byte-level similarity too imprecise. To mitigate these side effects, after the initial clustering step, we per- form a refinement on its output by adding inter-clusters edges whenever two samples in the same time window</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: right;"><a href="#bookmark15" class="s4">share the same submission origin (i.e., either from the same IP address or using the same email address for the registration). These are “weak” connections that do not model a real similarity between samples, and therefore they are more prone to false positives. As a consequence, our system does not use them when performing its auto- mated analysis to report suspicious clusters. However, as explained in Section </a>6, these extra connections can be very useful during the analysis of a suspicious cluster to gain a more complete picture of a malware development. After executing this refinement step, we were able to link to our clusters an additional 10,811 previously iso- lated binaries. This procedure also connected several</p><p style="text-indent: 0pt;text-align: right;">clusters together, to form 225 macro groups of clusters.</p><p style="padding-top: 5pt;text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="4.2"><h2 style="padding-left: 32pt;text-indent: -26pt;text-align: left;"><a name="bookmark5">&zwnj;</a>Intra-cluster Analysis</h2><p style="padding-top: 7pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;">Once our system had clustered the binaries that likely belong to the same malware development, we investigate each cluster to extract more information about its char- acteristics. In particular, we perform a number of code- based analysis routines to understand if the samples in the same cluster share similar code-based features.</p><p style="padding-top: 5pt;text-indent: 0pt;text-align: left;"><br/></p><h3 style="padding-left: 6pt;text-indent: 0pt;text-align: left;">Code Normalization</h3><p style="padding-top: 8pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;"><a href="#bookmark48" class="s4">Code normalization is a technique that is widely used to transform binary code to a canonical form [</a>26]. In our study, we normalize the assembly code such that the dif- ferences between two binaries can be determined more accurately. Under the assumption that two consecutive variations of the same program are likely compiled with the same tool chain and the same options, code normal- ization can be very useful to remove the noise introduced by small variations between two binaries.</p><p style="padding-left: 5pt;text-indent: 9pt;text-align: justify;"><a href="#bookmark58" class="s4">There are several approaches that have been proposed to normalize assembly code [</a><a href="#bookmark71" class="s4">36, </a><a href="#bookmark56" class="s4">49, </a>34]. Some of them normalize just the operands, some the mnemonics, and some normalize both. In this paper, we chose to nor- malize only the operands so that we can preserve the semantics of the instructions. In particular, we imple- mented a set of IDA Pro plugins to identify all the func- tions in the code and then replace, for each instruction, each operand with a corresponding placeholder tag: <span class="s7">reg </span>for registers, <span class="s7">mem </span>for memory locations , <span class="s7">val </span>for con- stant values, <span class="s7">near </span>for near call offsets, and <span class="s7">ref </span>for ref- erences to memory locations. These IDA scripts were run in batch mode to pre-process all the samples in our clusters.</p><p style="padding-top: 6pt;text-indent: 0pt;text-align: left;"><br/></p><h3 style="padding-left: 6pt;text-indent: 0pt;text-align: left;">Programming Languages</h3><p style="padding-top: 7pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;">The second step in our intra-cluster analysis phase con- sists in trying to identify the programming language used</p><p style="padding-top: 3pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;"><a href="#bookmark15" class="s4">to develop the samples. The programming language can provide some hints about the type of development. For example, scripting languages are often used to develop tools or probes designed to exfiltrate information from the sandbox. Moreover, it is likely that a malware author would use the same programming language for all the in- termediate versions of the same malware. Therefore, if a cluster includes samples of a malware development, all samples should typically share the same programming language. Exceptions, as the one explained in Section </a>6, may point to interesting cases.</p><p style="padding-left: 5pt;text-indent: 9pt;text-align: justify;">To detect the programming language of a binary we implemented a simple set of heuristics that incorpo- rate the information extracted by three tools: <span class="s7">PEiD</span>, the <span class="s7">pefile </span>python library, and the Linux <span class="s7">strings </span>com- mand. First, we use <span class="s7">pefile </span>to parse the Import Ad- dress Table (IAT) and obtain the list of libraries that are linked to the binary. Then, we search for program- ming language specific keywords on the extracted list. For example, the “VB” keyword in the library name is a good indicator of using Visual Basic, and including <span class="s7">mscoree.dll </span>in the code can be linked to the usage of Microsoft <span class="s7">.NET</span>. In the second step of our analysis, we analyze the strings and the output of <span class="s7">PEiD </span>to detect com- piler specific keywords (e.g., <span class="s7">type info </span>and RTTI pro- duced by C++ compilers, or “Delphi” strings generated by the homonymous language).</p><p style="padding-left: 5pt;text-indent: 9pt;text-align: justify;">With these simple heuristics, we identified the pro- gramming language of 14,022 samples. The most rep- resented languages are Visual Basic (49%), C (21%), Delphi (18%), Visual Basic .Net (7%), and C++ (3%). The large number of Visual Basic binaries could be a consequence of the fact that a large number of available tools that automatically create generic malware programs adopt this language.</p><p style="padding-top: 6pt;text-indent: 0pt;text-align: left;"><br/></p><h3 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Fine-grained Sample Similarity</h3><p style="padding-top: 8pt;padding-left: 5pt;text-indent: 0pt;text-align: justify;">In this last phase, we look in more detail at the similar- ity among the samples in the same cluster. In particular, we are interested to know why two binaries show a cer- tain similarity: Did the author add a new function to the code? Did she modify a branch condition, or remove a basic block? Or maybe the code is exactly the same, and the difference is limited to some data items (such as a domain name, or a file path).</p><p style="padding-left: 5pt;text-indent: 9pt;text-align: justify;">To answer these questions, we first extract the time- line of each cluster, i.e., the sequence in which each sam- ple was submitted to the sandbox in chronological order. Moving along the timeline, we compare each couple of samples using a number of static analysis plugins we de- veloped for IDA Pro.</p><p style="padding-left: 5pt;text-indent: 0pt;text-align: right;">The analysis starts by computing and comparing the</p><p class="s3" style="padding-left: 5pt;text-indent: 0pt;text-align: right;">call graph <span class="p">of the two samples. In this phase we compare</span></p><p style="padding-top: 3pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;">the normalized code of each function, to check which functions of the second binary were present unchanged in the first binary. The output is a list of additional func- tion that were not present in the original file, plus a list of functions that were likely modified by the author – i.e., those function that share the same position in the call graph but whose code does not perfectly match. How- ever, at this level of granularity it is hard to say if some- thing was modified in the function or if the author just removed the function and added another with the same callee.</p><p style="padding-left: 5pt;text-indent: 9pt;text-align: justify;">Therefore, in these cases, we “zoom” into the function and repeat our analysis, this time comparing their <i>con- trol flow graphs </i>(CFGs). Using a similar graph-based approach, this time we look for differences at the basic block level. If the two CFGs are too different, we con- clude that the two functions are not one the evolution of the other. Otherwise, we automatically locate the differ- ent basic blocks and we generate a similarity measure that summarize the percentage of basic blocks that are shared by the two functions.</p><p style="padding-top: 5pt;text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="4.3"><h2 style="padding-left: 32pt;text-indent: -26pt;text-align: left;"><a name="bookmark6">&zwnj;</a>Feature Extraction</h2><p style="padding-top: 7pt;padding-left: 5pt;text-indent: 0pt;text-align: justify;">Based on the analysis described in the previous sections, our system automatically extracts a set of 48 attributes that we believe are relevant to study the dynamics of mal- ware development.</p><p style="padding-left: 5pt;text-indent: 9pt;text-align: justify;">This was done in two phases. First, we enriched each sample with 25 individual features, divided in six cate- gories (see the Appendix for a complete list of individual features). The first class includes self-explanatory file features (such as its name and size). The Timestamps features identify when the sample was likely created, when it was submitted to Anubis Sandbox, and when it was later observed in the wild. While the creation time of the binary (extracted from the PE headers) could be man- ually faked by the author, we observed that this is seldom the case in practice, in particular when the author submits a probe or an intermediate version of a program. In fact, in these cases we often observed samples in which the compilation time precedes the submission time by only few minutes.</p><p style="padding-left: 5pt;text-indent: 9pt;text-align: justify;">The third category of features contain the output of the VirusTotal analysis on the sample, including the set of la- bels associated by all AntiVirus software and the number of AVs that flag the sample as malicious. We then collect a number of features related to the user who submitted the sample. Since the samples are submitted using a web browser, we were able to extract information regarding the browser name and version, the language accepted by the system (sometime useful to identify the nationality of the user) and the IP from which the client was connect- ing from. Two features in this set require more explana-</p><p style="padding-top: 3pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;">tion. The email address is an optional field that can be specified when submitting a sample to the sandbox web interface. The proxy flag is instead an attempt to identify if the submitter is using an anonymization service. We created a list of IP addresses related to these services and we flagged the submissions in which the IP address of the submitter appears in the blacklist. In the Binary features set we record the output of the fine-grained binary anal- ysis scripts, including the number of sections and func- tions, the function coverage, and the metadata extracted by the PE files. Finally, in the last feature category we summarize the results of the sandbox behavioral report, such as the execution time, potential runtime errors, use of evasion techniques, and a number of boolean flags that represent which behavior was observed at runtime (e.g., HTTP traffic, TCP scans, etc.)</p><p style="padding-top: 1pt;text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;"><a href="#bookmark8" class="s4">In the second phase of our analysis we extended the previous features from a single sample to the cluster that contains it. Table </a>2 shows the final list of aggregated at- tributes, most of which are obvious extensions of the val- ues of each sample in the cluster. Some deserve instead a better explanation. For instance, the cluster <span class="s7">shape </span>(A3) describes how the samples are connected in the cluster: in a tightly connected group, in a chain in which each node is only similar to the next one, or in a mixed shape including a core group and a small tail. The <span class="s7">Functions diff </span>(B13) summarized how many functions have been modified in average between one sample and the next one. <span class="s7">Dev time </span>(B25) tells us how far apart in time each samples were submitted to the sandbox, and <span class="s7">Connect Back </span>(B24) counts how many samples in the cluster open a TCP connection toward the same /24 subnetwork from which the sample was submitted. This is a very com- mon behavior for probes, as well as for testing the data exfiltration component of a malicious program.</p><p style="padding-top: 1pt;text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;">Finally, some features such as the number of crashes (C8) and the average VT detection (D4) are not very in- teresting per se, but they become more relevant when compared with the number of samples in the cluster. For example, imagine a cluster containing three very simi- lar files. Two of them run without errors, while the third one crashes. Or two of them are not detected by AV sig- natures, but one is flagged as malware by most of the existing antivirus software.</p><p style="padding-top: 1pt;text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;"><a href="#bookmark15" class="s4">While we are aware of the fact that each feature could be easily evaded by a motivated attacker, as described in Section </a>6 the combinations of all them is usually suffi- cient to identify a large number of development clusters. Again, our goal is to show the feasibility of this approach and draw attention to a new problem, and not to propose its definitive solution.</p><h4 style="padding-top: 4pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">A: Cluster Features</h4><ol id="l3"><ol id="l4"><li data-list-text="A.1"><p class="s8" style="padding-top: 1pt;padding-left: 37pt;text-indent: -15pt;text-align: left;">Cluster id        The ID of the cluster</p></li><li data-list-text="A.2"><p class="s8" style="padding-left: 37pt;text-indent: -15pt;text-align: left;">Num Elements      The number of samples in the cluster</p></li><li data-list-text="A.3"><p class="s8" style="padding-left: 37pt;text-indent: -15pt;text-align: left;">Shape          An approximation of the cluster shape (GROUP—MIX—CHAIN)</p></li></ol></ol><h4 style="padding-top: 1pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">B: Samples Features</h4><p class="s8" style="padding-top: 1pt;padding-left: 22pt;text-indent: 0pt;line-height: 106%;text-align: left;">B.1-4 Filesize stats      Min, Max, Avg, and Variance of the samples filesize B.5-8 Sections stats      Min, Max, Avg, and Variance of the number of sections</p><p class="s8" style="padding-left: 22pt;text-indent: 0pt;line-height: 10pt;text-align: left;">B.9-12 Functions stats    Min, Max, Avg, and Variance of the number of functions</p><ol id="l5"><ol id="l6"><li data-list-text="B.13"><p class="s8" style="padding-left: 41pt;text-indent: -19pt;text-align: left;">Functions diff     Average number of different functions</p></li><li data-list-text="B.14"><p class="s8" style="padding-left: 41pt;text-indent: -19pt;text-align: left;">Sections diff      Average number of different sections</p></li><li data-list-text="B.15"><p class="s8" style="padding-left: 41pt;text-indent: -19pt;text-align: left;">Changes location    One of: Data, Code, Both, None</p></li><li data-list-text="B.16"><p class="s8" style="padding-left: 41pt;text-indent: -19pt;text-align: left;">Prog Languages     List of programming languages used during the development</p></li><li data-list-text="B.17"><p class="s8" style="padding-left: 41pt;text-indent: -19pt;text-align: left;">Filename Edit Distance  The Average edit distance of the samples’s filenames</p></li><li data-list-text="B.18"><p class="s8" style="padding-left: 41pt;text-indent: -19pt;text-align: left;">Avg Text Coverage   Avg text coverage of the .text sections</p></li></ol></ol><p class="s8" style="padding-left: 22pt;text-indent: 0pt;text-align: left;">B.19-22 CTS Time      Min, Max, Avg, and Variance of the difference between compile and the submission time</p><ol id="l7"><ol id="l8"><li data-list-text="B.23"><p class="s8" style="padding-left: 41pt;text-indent: -19pt;line-height: 11pt;text-align: left;">Compile time Flags   Booleans to flag <span class="s9">NULL </span>or constant compile times</p></li><li data-list-text="B.24"><p class="s8" style="padding-left: 41pt;text-indent: -19pt;line-height: 10pt;text-align: left;">Connect back      True if any file in the cluster contacts back the submitter’s /24 network</p></li><li data-list-text="B.25"><p class="s8" style="padding-left: 41pt;text-indent: -19pt;text-align: left;">Dev time        Average time between each submission (in seconds)</p></li></ol></ol><h4 style="padding-top: 1pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">C: Sandbox Features</h4><ol id="l9"><ol id="l10"><li data-list-text="C.1"><p class="s8" style="padding-top: 1pt;padding-left: 37pt;text-indent: -14pt;text-align: left;">Sandbox Only      Numer of samples seen only by the sandbox (and not from external sources)</p></li><li data-list-text="C.2"><p class="s8" style="padding-left: 37pt;text-indent: -14pt;text-align: left;">Short Exec        Number of samples terminating the analysis in less than 60s</p></li></ol></ol><p class="s8" style="padding-left: 22pt;text-indent: 0pt;text-align: left;">C.4-6 Exec Time       Min, Max, and Avg execution time of the samples within the sandbox</p><p class="s8" style="padding-left: 22pt;text-indent: 0pt;text-align: left;">C.7 Net Activity       The number of samples with network activity</p><p class="s8" style="padding-left: 22pt;text-indent: 0pt;text-align: left;">C.7 Time Window      Time difference between first and last sample in the cluster (in days)</p><p class="s8" style="padding-left: 22pt;text-indent: 0pt;text-align: left;">C.8 Num Crashes       Number of samples crashing during their execution inside the sandbox</p><h4 style="padding-left: 22pt;text-indent: 0pt;text-align: left;">D: Antivirus Features</h4><p class="s8" style="padding-top: 1pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">D.1-3 Malicious Events    Min, Max, Avg numbers of behavioral flags exibited by the samples</p><p class="s8" style="padding-left: 22pt;text-indent: 0pt;text-align: left;">D.4-5 VT detection     Average and Variance of VirusTotal detection of the samples in the cluster</p><ol id="l11"><ol id="l12"><li data-list-text="D.6"><p class="s8" style="padding-left: 37pt;text-indent: -15pt;text-align: left;">VT Confidence     Confidence of the VirusTotal score</p></li><li data-list-text="D.7"><p class="s8" style="padding-left: 37pt;text-indent: -15pt;text-align: left;">Min VT detection    The score for the sample with the minimum VirusTotal Detection</p></li><li data-list-text="D.8"><p class="s8" style="padding-left: 37pt;text-indent: -15pt;text-align: left;">Max VT detection    The score for the sample with the maximum VirusTotal Detection</p></li><li data-list-text="D.9"><p class="s8" style="padding-left: 37pt;text-indent: -15pt;text-align: left;">AV Labels        All the AV labels for the identified pieces of malware in the cluster</p></li></ol></ol><h4 style="padding-top: 1pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">E: Submitter Features</h4><ol id="l13"><ol id="l14"><li data-list-text="E.1"><p class="s8" style="padding-top: 1pt;padding-left: 36pt;text-indent: -14pt;text-align: left;">Num IPs         Number of unique IP addresses used by the submitter</p></li><li data-list-text="E.2"><p class="s8" style="padding-left: 36pt;text-indent: -14pt;text-align: left;">Num E-Mails      Number of e-mail addresses used by the submitter</p></li><li data-list-text="E.3"><p class="s8" style="padding-left: 36pt;text-indent: -14pt;text-align: left;">Accept Languages    Accepted Languages from the submitter’s browser</p></li></ol></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: center;"><a name="bookmark8">&zwnj;</a>Table 2: List of Features associated to each cluster</p><p style="padding-top: 2pt;text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 6pt;text-indent: 0pt;text-align: justify;"><a name="bookmark9">&zwnj;</a>Table 3: Classification accuracy, including detection and false positive rates, and the Area Under the ROC Curve (AUC)</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li></ol></li><li data-list-text="5"><h2 style="padding-left: 23pt;text-indent: -17pt;text-align: left;"><a name="bookmark10">&zwnj;</a>Machine Learning</h2><p style="padding-top: 10pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;">Machine learning provides a very powerful set of tech- niques to conduct automated data analysis. As the goal of this paper is to automatically distinguishing malware developments from other submissions, we tested with a</p><p style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;line-height: 106%;text-align: right;">number of machine learning techniques applied to the set of features we presented in detail in the previous section. Among the large number of machine learning algo- rithms we have tested our training data with, we have obtained the best results by using the logistic model tree (LMT). LMT combines the logistic regression and decision tree classifiers by building a decision tree whose</p><table style="border-collapse:collapse;margin-left:3pt" cellspacing="0"><tr style="height:17pt"><td style="width:106pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#E5E5E5"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:34pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#E5E5E5"><p class="s6" style="padding-left: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">AUC</p></td><td style="width:47pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#E5E5E5"><p class="s6" style="padding-right: 5pt;text-indent: 0pt;line-height: 10pt;text-align: right;">Det. Rate</p></td><td style="width:48pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#E5E5E5"><p class="s6" style="padding-right: 5pt;text-indent: 0pt;line-height: 10pt;text-align: right;">False Pos.</p></td></tr><tr style="height:12pt"><td style="width:106pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s6" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Full data</p></td><td style="width:34pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s6" style="padding-left: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">0.999</p></td><td style="width:47pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s6" style="padding-right: 5pt;text-indent: 0pt;line-height: 10pt;text-align: right;">98.7%</p></td><td style="width:48pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s6" style="padding-right: 5pt;text-indent: 0pt;line-height: 10pt;text-align: right;">0%</p></td></tr><tr style="height:11pt"><td style="width:106pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s6" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">10-folds Cross-Validation</p></td><td style="width:34pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s6" style="padding-left: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">0.988</p></td><td style="width:47pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s6" style="padding-right: 5pt;text-indent: 0pt;line-height: 10pt;text-align: right;">97.4%</p></td><td style="width:48pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s6" style="padding-right: 5pt;text-indent: 0pt;line-height: 10pt;text-align: right;">3.7%</p></td></tr><tr style="height:11pt"><td style="width:106pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s6" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">70% Percentage Split</p></td><td style="width:34pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s6" style="padding-left: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">0.998</p></td><td style="width:47pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s6" style="padding-right: 5pt;text-indent: 0pt;line-height: 10pt;text-align: right;">100%</p></td><td style="width:48pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s6" style="padding-right: 5pt;text-indent: 0pt;line-height: 10pt;text-align: right;">11.1%</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"/><p style="padding-left: 6pt;text-indent: 0pt;line-height: 11pt;text-align: left;"><a href="#bookmark63" class="s4">leaves have linear regression models [</a>41].</p><p style="padding-top: 9pt;text-indent: 0pt;text-align: left;"><br/></p><h3 style="padding-left: 6pt;text-indent: 0pt;text-align: left;">Training Set</h3><p style="padding-top: 9pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;">The most essential phase of machine learning is the train- ing phase where the algorithm learns how to distinguish the characteristics of different classes. The success of the training phase strictly depends on a carefully pre- pared labeled data. If the labeled data is not prepared</p><p style="padding-top: 3pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;">carefully, the outcome of machine learning can be mis- leading. To avoid this problem, we manually labeled a number of clusters that were randomly chosen between the ones created at the end of our analysis phase. Manual labeling was carried out by an expert that performed a manual static analysis of the binaries to identify the type and objective of each modification. With this manual ef- fort, we flagged 91 clusters as non-development and 66 as development. To estimate the accuracy of the LMT classifier, we conducted a 10-fold cross validation and a 70% percentage split evaluation on the training data.</p><p style="padding-top: 7pt;text-indent: 0pt;text-align: left;"><br/></p><h3 style="padding-left: 6pt;text-indent: 0pt;text-align: left;">Feature Selection</h3><p style="padding-top: 8pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;">In the previous section, we have presented a comprehen- sive set of features that we believe can be related to the evolution of samples and to distinguish malware devel- opments from ordinary malware samples. However, not all the features contribute in the same way to the final classification, and some works well only when used in combination with other classes.</p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;">To find the subset of features that achieves the opti- mal classification accuracy while helping us to obtain the list of features that contribute the most to it, we lever- aged a number of features selection algorithms that are widely used in machine learning literature: Chi-Square, Gain Ratio and Relief-F attribute evaluation. Chi-square attribute evaluation computes the chi-square statistics of each feature with respect to the class, which in our case is the fact of being a malware development or not. The Gain Ratio evaluation, on the other hand, evaluates the effect of the feature by measuring its gain ratio.  Fi- nally, the Relief-F attribute evaluation methodology as- signs particular weights to each feature according to how much they are successful to distinguish the classes from each other. This weight computation is based on the comparison of the probabilities of two nearest neighbors having the same class and the same feature value.</p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;">While the order slightly differs, the ten most effective features for the accuracy of the classifier for all three fea- ture selection algorithms are the same. As also the com- mon sense suggests, the features we extract from the bi- nary similarity and the analysis of the samples are the most successful. For example, the connect back feature that checks if the sample connects back to the same IP address of the submitter, the average edit distance of the filenames of the samples, the binary function similar- ity, and the sample compile time features are constantly ranked on the top of the list. The submitter features and the sandbox features are following the sample features in the list. All of the features except the number of sand- box evasions, the VirusTotal results, and the features we extracted from the differences on the file sizes in the clus- ters had a contribution to the accuracy. After removing</p><p style="padding-top: 3pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;"><a href="#bookmark16" class="s4">those features, we performed a number of experiments on the training set to visualize the contribution of the different feature sub-sets to the classification accuracy. Figure </a>1 shows (in log-scale) the impact of each class and combination of classes. Among all the classes the samples-based features produced the best combination of detection and false positive rates (i.e. 88.2% detection rate with 7.4% false positives). In particular, the ones based on the static and dynamic analysis of the binaries seem to be the core of the detection ability of the sys- tem. Interestingly, the cluster-based features alone are the worst between all sets, but they increase the accuracy of the final results when combined with other features.</p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;"><a href="#bookmark9" class="s4">The results of the final classifier are reported in Ta- ble </a>3: 97.4% detection with of 3.7% false positives, ac- cording to 10-folds cross validation experiment. Note that we decided to tune the classifier to favor detection over false positives, since the goal of our system is only to tag suspicious submissions that would still need to be manually verified by a malware analyst.</p><p style="padding-top: 4pt;text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="6"><h2 style="padding-left: 23pt;text-indent: -17pt;text-align: left;"><a name="bookmark11">&zwnj;</a>Results<a name="bookmark15">&zwnj;</a></h2><p style="padding-top: 10pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;">Our prototype implementation was able to collect sub- stantial evidences related to a large number of malware developments.</p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;">In total, our system flagged as potential development 3038 clusters over a six years period. While this number was too large for us to perform a manual verification of each case, if such a system would be deployed we es- timate between two and three alerts generated per day. Therefore, we believe our tool could be used as part of an early warning mechanism to automatically collect in- formation about suspicious submissions and report them to human experts for further investigation.</p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;">In addition to the 157 clusters already manually la- beled to prepare the training set for the machine learning component, we also manually verified 20 random clus- ters automatically flagged as suspicious by our system. Although according to the 10-fold cross validation exper- iments the false positive rate is 3.7%, we have not found any false positives on the clusters we randomly selected for our manual validation.</p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;">Our system automatically detected the development of a diversified group of real-world malware, ranging from generic trojans to advanced rootkits. To better under- stand the distribution of the different malware families, we verified the AV labels assigned to each reported clus- ter. According to them, 1474 clusters were classified as malicious, out of which our system detected the develop- ment of 45 botnets, 1082 trojans, 83 backdoors, 4 key- loggers, 65 worms, and 21 malware development tools (note that each development contained several different samples modeling intermediate steps). A large fraction</p><p style="padding-top: 2pt;text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">128</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 64pt;text-indent: 0pt;text-align: left;">64</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 64pt;text-indent: 0pt;text-align: left;">32</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 379pt;text-indent: 0pt;line-height: 5pt;text-align: left;">Wrong Classiﬁca;ons</p><p class="s10" style="padding-left: 64pt;text-indent: 0pt;line-height: 5pt;text-align: left;">16</p><p class="s10" style="padding-top: 4pt;padding-left: 379pt;text-indent: 0pt;text-align: left;">Detec;on Rate</p><p style="padding-top: 2pt;text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 67pt;text-indent: 0pt;text-align: left;">8                                                  False Posi;ves</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 67pt;text-indent: 0pt;text-align: left;">4</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 67pt;text-indent: 0pt;text-align: left;">2</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="text-indent: 0pt;line-height: 5pt;text-align: left;">submi-er (sub)</p><p style="text-indent: 0pt;text-align: left;"/><p class="s10" style="text-indent: 0pt;line-height: 5pt;text-align: left;">sample (samp)</p><p style="text-indent: 0pt;text-align: left;"/><p class="s10" style="text-indent: 0pt;line-height: 5pt;text-align: left;">sandbox (sand)</p><p style="text-indent: 0pt;text-align: left;"/><p class="s10" style="text-indent: 0pt;line-height: 5pt;text-align: left;">cluster (clus)</p><p style="text-indent: 0pt;text-align: left;"/><p class="s10" style="text-indent: 0pt;line-height: 5pt;text-align: left;">an;virus</p><p style="text-indent: 0pt;text-align: left;"/><p class="s10" style="text-indent: 0pt;line-height: 5pt;text-align: left;">sample+submi-er</p><p style="text-indent: 0pt;text-align: left;"/><p class="s10" style="text-indent: 0pt;line-height: 5pt;text-align: left;">sample+sandbox</p><p style="text-indent: 0pt;text-align: left;"/><p class="s10" style="text-indent: 0pt;line-height: 5pt;text-align: left;">sample+cluster</p><p style="text-indent: 0pt;text-align: left;"/><p class="s10" style="text-indent: 0pt;line-height: 5pt;text-align: left;">sample+av</p><p style="text-indent: 0pt;text-align: left;"/><p class="s10" style="text-indent: 0pt;line-height: 5pt;text-align: left;">sample+cluster+submi-er</p><p style="text-indent: 0pt;text-align: left;"/><p class="s10" style="text-indent: 0pt;line-height: 5pt;text-align: left;">sample+cluster+sandbox</p><p style="text-indent: 0pt;text-align: left;"/><p class="s10" style="text-indent: 0pt;line-height: 5pt;text-align: left;">sample+cluster+av</p><p style="text-indent: 0pt;text-align: left;"/><p class="s10" style="text-indent: 0pt;line-height: 5pt;text-align: left;">samp+clusr+sub+av</p><p style="text-indent: 0pt;text-align: left;"/><p class="s10" style="text-indent: 0pt;line-height: 5pt;text-align: left;">samp+clus+sub+sand_selected</p><p style="text-indent: 0pt;text-align: left;"/><p class="s10" style="padding-left: 67pt;text-indent: 0pt;text-align: left;">1</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: center;"><a name="bookmark16">&zwnj;</a>Figure 1: Classification success of different feature combinations.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:57.152pt" cellspacing="0"><tr style="height:17pt"><td style="width:83pt" bgcolor="#C8C8C8"><p class="s11" style="padding-left: 5pt;text-indent: 0pt;line-height: 11pt;text-align: left;">Campaign</p></td><td style="width:82pt" bgcolor="#C8C8C8"><p class="s11" style="text-indent: 0pt;line-height: 11pt;text-align: center;">Early Submission</p></td><td style="width:135pt" bgcolor="#C8C8C8"><p class="s11" style="text-indent: 0pt;line-height: 11pt;text-align: center;">Time Before Public Disclosure</p></td><td style="width:66pt" bgcolor="#C8C8C8"><p class="s11" style="text-indent: 0pt;line-height: 11pt;text-align: center;">Submitted by</p></td></tr><tr style="height:12pt"><td style="width:83pt"><p class="s11" style="padding-left: 5pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Operation Aurora</p></td><td style="width:82pt"><p class="s12" style="text-indent: 0pt;line-height: 10pt;text-align: center;">✓</p></td><td style="width:135pt"><p class="s11" style="text-indent: 0pt;line-height: 10pt;text-align: center;">4 months</p></td><td style="width:66pt"><p class="s11" style="text-indent: 0pt;line-height: 10pt;text-align: center;">US</p></td></tr><tr style="height:12pt"><td style="width:83pt"><p class="s11" style="padding-left: 5pt;text-indent: 0pt;line-height: 11pt;text-align: left;">Red October</p></td><td style="width:82pt"><p class="s12" style="text-indent: 0pt;line-height: 11pt;text-align: center;">✓</p></td><td style="width:135pt"><p class="s11" style="text-indent: 0pt;line-height: 11pt;text-align: center;">8 months</p></td><td style="width:66pt"><p class="s11" style="text-indent: 0pt;line-height: 11pt;text-align: center;">Romania</p></td></tr><tr style="height:12pt"><td style="width:83pt"><p class="s11" style="padding-left: 5pt;text-indent: 0pt;line-height: 11pt;text-align: left;">APT1</p></td><td style="width:82pt"><p class="s12" style="text-indent: 0pt;line-height: 11pt;text-align: center;">✓</p></td><td style="width:135pt"><p class="s11" style="text-indent: 0pt;line-height: 11pt;text-align: center;">43 months</p></td><td style="width:66pt"><p class="s11" style="text-indent: 0pt;line-height: 11pt;text-align: center;">US</p></td></tr><tr style="height:12pt"><td style="width:83pt"><p class="s11" style="padding-left: 5pt;text-indent: 0pt;line-height: 11pt;text-align: left;">Stuxnet</p></td><td style="width:82pt"><p class="s12" style="text-indent: 0pt;line-height: 11pt;text-align: center;">✓</p></td><td style="width:135pt"><p class="s11" style="text-indent: 0pt;line-height: 11pt;text-align: center;">1 months</p></td><td style="width:66pt"><p class="s11" style="text-indent: 0pt;line-height: 11pt;text-align: center;">US</p></td></tr><tr style="height:12pt"><td style="width:83pt"><p class="s11" style="padding-left: 5pt;text-indent: 0pt;line-height: 11pt;text-align: left;">Beebus</p></td><td style="width:82pt"><p class="s12" style="text-indent: 0pt;line-height: 11pt;text-align: center;">✓</p></td><td style="width:135pt"><p class="s11" style="text-indent: 0pt;line-height: 11pt;text-align: center;">22 months</p></td><td style="width:66pt"><p class="s11" style="text-indent: 0pt;line-height: 11pt;text-align: center;">Germany</p></td></tr><tr style="height:12pt"><td style="width:83pt"><p class="s11" style="padding-left: 5pt;text-indent: 0pt;line-height: 11pt;text-align: left;">LuckyCat</p></td><td style="width:82pt"><p class="s12" style="text-indent: 0pt;line-height: 11pt;text-align: center;">✓</p></td><td style="width:135pt"><p class="s11" style="text-indent: 0pt;line-height: 11pt;text-align: center;">3 months</p></td><td style="width:66pt"><p class="s11" style="text-indent: 0pt;line-height: 11pt;text-align: center;">US</p></td></tr><tr style="height:12pt"><td style="width:83pt"><p class="s11" style="padding-left: 5pt;text-indent: 0pt;line-height: 11pt;text-align: left;">BrutePOS</p></td><td style="width:82pt"><p class="s12" style="text-indent: 0pt;line-height: 11pt;text-align: center;">✓</p></td><td style="width:135pt"><p class="s11" style="text-indent: 0pt;line-height: 11pt;text-align: center;">5 months</p></td><td style="width:66pt"><p class="s11" style="text-indent: 0pt;line-height: 11pt;text-align: center;">France</p></td></tr><tr style="height:12pt"><td style="width:83pt"><p class="s11" style="padding-left: 5pt;text-indent: 0pt;line-height: 11pt;text-align: left;">NetTraveller</p></td><td style="width:82pt"><p class="s12" style="text-indent: 0pt;line-height: 11pt;text-align: center;">✓</p></td><td style="width:135pt"><p class="s11" style="text-indent: 0pt;line-height: 11pt;text-align: center;">14 months</p></td><td style="width:66pt"><p class="s11" style="text-indent: 0pt;line-height: 11pt;text-align: center;">US</p></td></tr><tr style="height:12pt"><td style="width:83pt"><p class="s11" style="padding-left: 5pt;text-indent: 0pt;line-height: 11pt;text-align: left;">Pacific PlugX</p></td><td style="width:82pt"><p class="s12" style="text-indent: 0pt;line-height: 11pt;text-align: center;">✓</p></td><td style="width:135pt"><p class="s11" style="text-indent: 0pt;line-height: 11pt;text-align: center;">12 months</p></td><td style="width:66pt"><p class="s11" style="text-indent: 0pt;line-height: 11pt;text-align: center;">US</p></td></tr><tr style="height:12pt"><td style="width:83pt"><p class="s11" style="padding-left: 5pt;text-indent: 0pt;line-height: 11pt;text-align: left;">Pitty Tiger</p></td><td style="width:82pt"><p class="s12" style="text-indent: 0pt;line-height: 11pt;text-align: center;">✓</p></td><td style="width:135pt"><p class="s11" style="text-indent: 0pt;line-height: 11pt;text-align: center;">42 months</p></td><td style="width:66pt"><p class="s11" style="text-indent: 0pt;line-height: 11pt;text-align: center;">US</p></td></tr><tr style="height:12pt"><td style="width:83pt"><p class="s11" style="padding-left: 5pt;text-indent: 0pt;line-height: 11pt;text-align: left;">Regin</p></td><td style="width:82pt"><p class="s12" style="text-indent: 0pt;line-height: 11pt;text-align: center;">✓</p></td><td style="width:135pt"><p class="s11" style="text-indent: 0pt;line-height: 11pt;text-align: center;">44 months</p></td><td style="width:66pt"><p class="s11" style="text-indent: 0pt;line-height: 11pt;text-align: center;">UK</p></td></tr><tr style="height:15pt"><td style="width:83pt"><p class="s11" style="padding-left: 5pt;text-indent: 0pt;line-height: 11pt;text-align: left;">Equation</p></td><td style="width:82pt"><p class="s12" style="text-indent: 0pt;line-height: 11pt;text-align: center;">✓</p></td><td style="width:135pt"><p class="s11" style="text-indent: 0pt;line-height: 11pt;text-align: center;">23 months</p></td><td style="width:66pt"><p class="s11" style="text-indent: 0pt;line-height: 11pt;text-align: center;">US</p></td></tr></table><p style="padding-top: 5pt;text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 84pt;text-indent: 0pt;text-align: center;"><a name="bookmark17">&zwnj;</a>Table 4: Popular campaigns of targeted attacks in the sandbox database</p><p style="padding-top: 4pt;text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;">of the clusters that were not identified by the AV sig- natures contained the development of probes, i.e., small programs whose goal is only to collect and transmit in- formation about the system where they run.  Finally, some clusters also contained the development or testing of offensive tools, such as packers and binders.</p><p style="padding-top: 3pt;text-indent: 0pt;text-align: left;"><br/></p><ol id="l15"><li data-list-text="6.1"><h2 style="padding-left: 32pt;text-indent: -26pt;text-align: left;"><a name="bookmark12">&zwnj;</a>Targeted Attacks Campaigns</h2><p style="padding-top: 6pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;">Before looking at some of the malware development cases detected by our system, we wanted to verify our initial hypothesis that even very sophisticated malware</p><p style="padding-top: 4pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;"><a href="#bookmark17" class="s4">used in targeted attacks are often submitted to public sandboxes months before the real attacks are discovered. For this reason, we created a list of hashes of known and famous APT campaigns, such as the ones used in op- eration Aurora and Red October. In total, we collected 1271 MD5s belonging to twelve different campaigns. As summarized in Table </a>4, in all cases we found at least one sample in our database before the campaign was publicly discovered (<i>Early Submission </i>column). For example, for Red October the first sample was submitted in February 2012, while the campaign was later detected in October</p><p style="padding-top: 3pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">2012. The sample of Regin was collected a record 44</p><p class="s13" style="padding-top: 4pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">Sample 1   Sample 2  Sample 3</p><p style="padding-left: 6pt;text-indent: 0pt;text-align: justify;">months before the public discovery.</p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;">Finally, we checked from whom those samples were submitted to the system. Interestingly, several samples were first submitted by large US universities. A possi-</p><p style="padding-top: 4pt;text-indent: 0pt;text-align: left;"><br/></p><p class="s14" style="padding-left: 6pt;text-indent: 0pt;line-height: 145%;text-align: left;">Submission time Compile time</p><p class="s15" style="padding-top: 4pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">16:59:33</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s15" style="padding-left: 6pt;text-indent: 0pt;text-align: left;">16:59:13</p><p class="s15" style="padding-top: 3pt;padding-left: 15pt;text-indent: 0pt;text-align: left;">17:06:06</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s15" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">17:05:21</p><p class="s15" style="padding-top: 3pt;padding-left: 31pt;text-indent: 0pt;text-align: left;">17:14:16</p><p style="padding-top: 3pt;text-indent: 0pt;text-align: left;"><br/></p><p class="s15" style="padding-left: 74pt;text-indent: 0pt;line-height: 6pt;text-align: left;">t</p><p class="s15" style="padding-left: 6pt;text-indent: 0pt;line-height: 6pt;text-align: left;">17:13:26</p><p style="padding-left: 6pt;text-indent: 0pt;text-align: justify;">ble explanation is that those samples were automatically collected as part of a network-based monitoring infras- tructure maintained by security researchers. Other were instead first submitted by individual users (for whom we do not have much information) from several differ- ent countries, including US, France, Germany, UK, and Romania. Even more interesting, some were first sub- mitted from DSL home Internet connections. However, we cannot claim that we observed the development phase of these large and popular targeted attacks campaigns as in all cases the samples were already observed in the wild (even though undetected and no one was publicly aware of their existence) before they were submitted to our sandbox. It is important to note that for this exper- iment we considered the entire dataset, without apply- ing any filtering and clustering strategy. In fact, in this case we did not want to spot the <i>development </i>of the APT samples, but simply the fact that those samples were sub- mitted and available to researchers long before they were publicly discovered.</p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;">We believe the sad message to take away from this ex- periment is that all those samples went unnoticed. As a community, there is a need for some kind of early warn- ing system to report suspicious samples to security re- searches. This could prevent these threats from flying under the radar and could save months (or even years) of damage to the companies targeted by these attacks.</p><p style="padding-top: 5pt;text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="6.2"><h2 style="padding-left: 32pt;text-indent: -26pt;text-align: left;"><a name="bookmark13">&zwnj;</a>Case studies</h2><p style="padding-top: 7pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;">In the rest of this section we describe in more details three development scenarios. While our system identi- fied many more interesting cases, due to space limitation we believe the following brief overview provides a valu- able insight on the different ways in which attackers use (and misuse) public sandboxes. Moreover, it also shows how a security analyst can use the information collected by our system to investigate each case, and reconstruct both the author behavior and his final goal.</p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;">In the first example, the malware author introduced an anti-sandbox functionality to a Trojan application. In this case the analyst gathers intelligence information about the modus operandi of the attacker and about all the de- velopment phases.</p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;">In the second scenario, we describe a step by step de- velopment in which the attacker tries to collect informa- tion from the sandbox. This information is later used to detect the environment and prevent the execution of a future malware in the sandbox. In the last example,</p><p style="padding-left: 36pt;text-indent: 0pt;text-align: left;"><a name="bookmark18">&zwnj;</a>Figure 2: Anti-sandbox check - Timeline</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 6pt;text-indent: 0pt;text-align: justify;">we show how an attacker uses the sandbox as a testbed to verify the behavior of the malware. In this case, the author generated the binary using one of the many ded- icated builder applications that can be downloaded from the Internet or bought on the black market.</p><p class="s3" style="padding-top: 10pt;padding-left: 15pt;text-indent: 0pt;text-align: justify;">Example I: Anti-sandbox Malware</p><p style="padding-top: 2pt;padding-left: 6pt;text-indent: 9pt;text-align: justify;"><a href="#bookmark18" class="s4">The cluster related to this example contains three sam- ples. The timeline (summarized in Figure </a>2) already sug- gests a possible development. In fact, the difference be- tween the <span class="s7">submission </span>time and the <span class="s7">compile </span>time is very small.</p><p style="padding-top: 1pt;padding-left: 6pt;text-indent: 9pt;text-align: justify;">A quick look at the static features of the cluster shows that the three samples are very similar, and share the same strings as well as the same imphash (the <i>import hash </i><a href="#bookmark42" class="s4">[</a><a href="#bookmark43" class="s4">20, </a>21] recently introduced also by VirusTotal). However, the first sample is composed of 21 functions, while the last two samples have 22 functions. Our report also shows how the first and the second samples differ for two functions: the author modified the function <span class="s7">start</span>, and introduced a new function <span class="s7">CloseHandle</span>. This in- formation (so far extracted completely automatically by our system) is a good starting point for a closer analysis.</p><p style="padding-top: 1pt;padding-left: 6pt;text-indent: 9pt;text-align: justify;"><a href="#bookmark19" class="s4">We opened the two executables in IDA Pro, and quickly identified the two aforementioned functions (snippet in Figure </a>3). It was immediately clear that the <span class="s7">start </span>function was modified to add an additional ba- sic block and a call to the new <span class="s7">CloseHandle </span>function. The new basic block uses the <span class="s7">rdtsc </span>x86 instruction to read the value of the Timestamp Counter Register (TSC), which contains the number of CPU cycles since the last reset. The same snippet of assembly is called two times to check the time difference. After the first <span class="s7">rdtsc </span>in- struction there is a call to <span class="s7">CloseHandle</span>, using the times- tamp as handler (probably an invalid handler). These two well known tricks are here combined to detect the Anubis Sandbox environment – due to the delay introduced by its checks during program execution. The Anubis Sand- box’s core is slower in looking up the handlers table, and this time discrepancy is the key to detect the analysis en- vironment. In this case the difference has to be less than <span class="s7">0E0000h</span>, or the program would immediately terminate by calling the <span class="s7">ExitProcess </span>function.</p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;">The last sample in the cluster was submitted only to tune the threshold and for this reason there were no im- portant differences with the second sample. The <i>control</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s16" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">First Sample                    <span class="s17">Second Sample</span></p><p style="padding-top: 8pt;text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: center;"><a name="bookmark19">&zwnj;</a>Figure 3: Anti-sandbox check - Start function comparison</p><p style="padding-top: 4pt;text-indent: 0pt;text-align: left;"><br/></p><p class="s3" style="padding-top: 4pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;">flow graph <span class="p">analysis performed automatically by our sys- tem report a very high similarity between the first two samples, in line with the little modifications we found in the disassembled code. Finally, the behavioral features extracted by our system confirm our hypothesis: the first sample was executed until the analysis timeout, but the execution of the second one terminated after only five seconds.</span></p><p style="padding-top: 1pt;padding-left: 6pt;text-indent: 9pt;text-align: justify;">The behavior described so far suggest malicious in- tents. This is also confirmed by other cluster metadata. For instance, while the first sample in the cluster was unknown to VirusTotal, the last one was clearly identi- fied as a common <span class="s7">Trojan </span>application. This suggests that the original sample, without the timing check, has never been used in the wild. Once more, the fact that all three samples have been submitted days before the trojan was first observed in the wild strongly supports the fact that the person who submitted them was indeed the malware author.</p><p class="s3" style="padding-top: 10pt;padding-left: 15pt;text-indent: 0pt;text-align: justify;">Example II: Testing a Trojan Dropper</p><p style="padding-top: 2pt;padding-left: 6pt;text-indent: 9pt;text-align: justify;">The second cluster we want to describe is composed of five samples. Our report indicates that the first four are written in Delphi and the last one is written in Visual Basic. This is already a strange fact, since the two pro- gramming languages are quite different and it is unlikely that they could generate similar binaries.</p><p style="padding-top: 1pt;padding-left: 6pt;text-indent: 9pt;text-align: justify;">In this case the cluster timeline does not provide use- ful information as all the Delphi samples share exactly the same compilation time: 20th of June, 1992. Only the Visual Basic sample had a compilation time consistent with the submission. On the contrary, the submission times provide an interesting perspective. All the samples have been submitted in few hours and this might indi- cate a possible development. In addition, there are two IP addresses involved: one for the four Delphi samples and one for the final Visual Basic version. The static fea-</p><p style="padding-top: 4pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;">tures of the first four samples show very little differences, suggesting that these are likely just small variations of the same program. In average, they share 169 out of 172 functions and 7 out of 8 PE sections. By inspect- ing the changes, we notice that the attacker was adding some threads synchronization code to a function respon- sible for injecting code into a different process. The <i>con- trol flow graph </i>similarity reported by our tool was over 98%, confirming the small differences we observed be- tween each versions. Once the author was happy with the result, she submitted one more sample, this time com- pletely different from the previous ones. Despite the ob- vious differences in most of the static analysis features, the fuzzyhash similarity with sample 4 was 100%. A rapid analysis showed that this perfect match was due to the fact that the Visual Basic application literally em- bedded the entire binary of the fourth Delphi program. In addition, the behavior report confirmed that, once ex- ecuted, the Visual Basic Trojan dropped the embedded executable that was later injected inside a target process. None of the Antivirus software used by VirusTotal rec- ognized the first four samples as malicious. However, the last one was flagged by 37 out of 50 AVs as a <i>trojan dropper </i>malware.</p><p style="padding-top: 1pt;padding-left: 6pt;text-indent: 9pt;text-align: justify;">It is important to stress that a clear advantage of our system is that it was able to automatically reconstruct the entire picture despite the fact that not all samples were submitted from the same IP address (even though all lo- cated in the same geographical area). Moreover, we were able to propagate certain metadata extracted by our sys- tem (for example the username of the author extracted from the binary compiled with Visual Studio) from one sample to the others in which that information was miss- ing. This ability to retrieve and propagate metadata be- tween different samples can be very useful during an in- vestigation.</p><p style="padding-top: 1pt;padding-left: 15pt;text-indent: 0pt;text-align: justify;">Another very interesting aspect of this malware devel-</p><p style="padding-top: 6pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;">opment is the fact that after the process injection, the pro- gram used a well known dynamic DNS service (<span class="s7">no-ip</span>) to resolve a domain name. The IP address returned by the DNS query pointed exactly to the same machine that was used by the author to submit the sample. This suggests that the attacker was indeed testing his attack before re- leasing it, and this information could be used to locate the attacker machine.</p><p style="padding-top: 6pt;padding-left: 6pt;text-indent: 9pt;text-align: justify;">We identified a similar <i>connect-back </i>behavior in other 1817 clusters. We also noticed how most of these clus- ters contain samples generated by known trojan <i>builders</i><a href="#bookmark30" class="s4">, like Bifrost [</a><a href="#bookmark31" class="s4">8] or PoisonIvy [</a><a href="#bookmark44" class="s4">9]. While this may seem to prove that these are mostly unsophisticated attacks, Fire- Eye [</a><a href="#bookmark29" class="s4">22] recently observed how the Xtremerat builder [</a>7] (which appeared in 28 of our clusters) was used to pre- pare samples used in several targeted attacks.</p><p class="s3" style="padding-top: 9pt;padding-left: 15pt;text-indent: 0pt;text-align: justify;">Example III: Probe Development</p><p style="padding-top: 1pt;padding-left: 6pt;text-indent: 9pt;text-align: justify;">In this last example we show an attacker fingerprint- ing the analysis environment and how, at the end, she manages to create her own successful antisandbox check. The cluster consists of two samples, both submitted from France in a time span of 23 hours by the same IP ad- dress. The two samples have the same size, the same number of functions (164), and of sections (4). There is only one function (<span class="s7">_start</span>) and two sections (<span class="s7">.text </span>and <span class="s7">.rdata</span>) presenting some differences. The two pro- grams perform the same actions, they create an empty text file and then they retrieve the file attributes through the API <span class="s7">GetFileAttributes</span>. The only differences are on the API version they use (<span class="s7">GetFileAttributesA </span>or <span class="s7">GetFileAttributesW</span>) and on the file name to open.</p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;"><a href="#bookmark7" class="s4">At a first look, this cluster did not seem very inter- esting. However the inter-cluster connections pointed to other six loosely correlated samples submitted by the same author in the same week. As explained in Section </a>4, these files have not been included in the core cluster be- cause the binary similarity was below our threshold. In this case, these samples were all designed either to col- lect information or to test anti-virtualization/emulation tricks.  For instance, one binary implemented all the known techniques based on <span class="s7">idt</span>, <span class="s7">gdt </span>and <span class="s7">ldt </span><a href="#bookmark70" class="s4">to de- tect a virtual machine monitor [</a><a href="#bookmark69" class="s4">48, </a><a href="#bookmark64" class="s4">47, </a>42]. Another one simply retrieved the computer name, and another one was designed to detect the presence of inline hooking. Putting all the pieces together, it is clear that the author was preparing a number of probes to assess various as- pects of the sandbox environment.</p><p style="padding-top: 1pt;padding-left: 6pt;text-indent: 9pt;text-align: justify;">This example shows how valuable the inter-clusters edges can be to better understand and link together differ- ent submissions that, while different between each other at a binary level, are likely part of the same organized “campaign”.</p></li><li data-list-text="6.3"><h2 style="padding-top: 4pt;padding-left: 32pt;text-indent: -26pt;text-align: left;"><a name="bookmark14">&zwnj;</a>Malware Samples in the Wild</h2><p style="padding-top: 8pt;padding-left: 5pt;text-indent: 0pt;text-align: right;">As we already mentioned at the beginning of the sec- tion, out of 3038 clusters reported as malware develop- ment candidates by our machine learning classifier, 1474 (48%) contained binaries that were detected by the an- tivirus signatures as malicious (according to VirusTotal). A total of 228 of the files contained in these clusters were later detected in the wild by the Symantec’s an- tivirus engine. The average time between the submission to our sandbox and the time the malware was observed in the wild was 135 days – i.e., it took between four and five months for the antivirus company to develop a signa- ture and for the file to appear on the end-users machines. Interestingly, some of these binaries were later detected on more than 1000 different computers in 13 different countries all around the world (obviously a lower bound, based on the alerts triggered on a subset of the Syman- tec’s customers). This proves that, while these may not be very sophisticated malware, they certainly have a neg-</p><p style="padding-left: 6pt;text-indent: 0pt;text-align: justify;">ative impact on thousands of normal users.</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li></ol></li><li data-list-text="7"><h2 style="padding-left: 23pt;text-indent: -17pt;text-align: left;"><a name="bookmark20">&zwnj;</a>Limitations</h2><p style="padding-top: 11pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;">We are aware of the fact that once this research is pub- lished, malware authors can react and take countermea- sures to sidestep this type of analysis systems. For in- stance, they may decide to use “private” malware check- ers, and avoid interacting with public sandboxes alto- gether. First of all, this is a problem that applies to many analysis techniques ranging from botnet detection, to in- trusion prevention, to malware analysis. Despite that, we believe that it is important to describe our findings so that other researchers can work in this area and propose more robust methodologies in the future.</p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;"><a href="#bookmark74" class="s4">Moreover, as we mentioned in the introduction, af- ter we completed our study someone noticed that some known malware development groups were testing their creation on VirusTotal [</a><a href="#bookmark49" class="s4">52, </a>27]. This confirms that what we have found is not an isolated case but a widespread phenomenon that also affects other online analysis sys- tems. Second, now that the interaction between malware developers and public sandboxes is not a secret anymore, there is no reason that prevents us from publishing our findings as well.</p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;">We are aware of the fact that our methodology is not perfect, that it can be evaded, and that cannot catch all de- velopment cases. However, we believe the key message of the paper is that malware authors are abusing public sandboxes to test their code, and at the moment we do not need a very sophisticated analysis to find them. Since this is the first paper that tries to identify these cases, we found that our approach was already sufficient to detect</p><p style="padding-top: 3pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;">thousands of them. Certainly more research is needed in this area to develop more precise monitoring and early warning system to analyze the large amounts of data au- tomatically collected by public services on a daily basis.</p><p style="padding-top: 4pt;text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="8"><h2 style="padding-left: 23pt;text-indent: -17pt;text-align: left;"><a name="bookmark21">&zwnj;</a>Related Work</h2><p style="padding-top: 10pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;"><a href="#bookmark46" class="s4">While there has been an extensive amount of research on malware analysis and detection, very few works in the literature have studied the datasets collected by public malware dynamic analysis sandboxes. The most compre- hensive study in this direction was conducted by Bayer et al. [</a><a href="#bookmark32" class="s4">24]. The authors looked at two years of Anubis [</a>10] reports and they provided several statistics about mal- ware evolution and about the prevalent types of malicious behaviors observed in their dataset.</p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;"><a href="#bookmark65" class="s4">Lindorfer et al. [</a><a href="#bookmark66" class="s4">43] conducted the first study in the area of malware development by studying the evolution over time of eleven known malware families. In partic- ular, the authors documented the malware updating pro- cess and the changes in the code for a number of dif- ferent versions of each family. In our study we look at the malware development process from a different angle. Instead of studying different versions of the same well known malware, we try to detect, on a large scale, the au- thors of the malware at the moment in which they interact with the sandbox itself. In a different paper, Lindorfer et al. [</a>44] proposed a technique to detect environment sen- sitive malware. The idea is to execute each malware sam- ple multiple times on several sandboxes equipped with different monitoring implementations and then compare the normalized reports to detect behavior discrepancies.</p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;"><a href="#bookmark52" class="s4">A similar research area studies the phylogeny [</a>30] of malware by using approaches taken from the biology field. Even if partially related to our work, in our study we were not interested in understanding the relationship between different species of malware, but only to detect suspicious submissions that may be part of a malware development activity.</p><p style="padding-left: 6pt;text-indent: 9pt;text-align: justify;"><a href="#bookmark56" class="s4">In a paper closer to our work, Jang et al. [</a><a href="#bookmark34" class="s4">34] studied how to infer the software evolution looking at program binaries. In particular, the authors used both static and dynamic analysis features to recover the software lin- eage. While Jang’s paper focused mostly on benign pro- grams, some experiments were also conducted on 114 malicious software with known lineage extracted from the Cyber Genome Project [</a>12]. Compared to our work, the authors used a smaller set of static and dynamic fea- tures especially designed to infer the software lineage (e.g., the fact that a linear development is characterized by a monotonically increasing file size). Instead, we use a richer set of features to be able to distinguish mal- ware developments from variations of the same samples collected on the wild and not submitted by the author.</p><p style="padding-top: 3pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;">While our approaches share some similarities, the goals are clearly different.</p><p style="padding-top: 1pt;padding-left: 6pt;text-indent: 9pt;text-align: justify;"><a href="#bookmark51" class="s4">Other approaches have been proposed in the litera- ture to detect similarities among binaries. Flake [</a>29] proposed a technique to analyze binaries as graphs of graphs, and we have been inspired by his work for the <i>control flow analysis </i><a href="#bookmark7" class="s4">described in Section </a><a href="#bookmark61" class="s4">4. Kruegel et al. [</a>39] proposed a similar technique in which they ana- lyzed the control flow graphs of a number of worms and they used a graph coloring technique to cope with the graph-isomorphism problem.</p><p style="padding-top: 1pt;padding-left: 6pt;text-indent: 9pt;text-align: justify;"><a href="#bookmark53" class="s4">Finally, one step of our technique required to cluster together similar malware samples. There are several pa- pers in the area of malware clustering [</a><a href="#bookmark55" class="s4">31, </a><a href="#bookmark73" class="s4">33, </a><a href="#bookmark54" class="s4">51, </a>32]. However, their goal is to cluster together samples belong- ing to the same malware family as fastest as possible and with the highest accuracy. This is a crucial task for all the Antivirus companies. However, our goal is differ- ent as we are interested in clustering samples based only on binary similarity and we do not have any interest in clustering together members of the same family based on their behavior.</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="9"><h2 style="padding-left: 23pt;text-indent: -17pt;text-align: left;"><a name="bookmark22">&zwnj;</a>Conclusion</h2></li></ol><p style="padding-top: 13pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;">Public dynamic analysis sandboxes collect thousands of new malware samples every day. Most of these submis- sions belong to well known malware families, or are be- nign files that do not pose any relevant security threat. However, hidden in this large amount of collected data, few samples have something special that distinguishes them from the rest. In this paper, we discussed the im- portance of looking at these samples from an intelligence and threat prevention point of view.</p><p style="padding-top: 1pt;padding-left: 6pt;text-indent: 9pt;text-align: justify;">We show that several binaries used in the most fa- mous targeted attack campaigns had been submitted to our sandbox months before the attack was first re- ported. Moreover, we propose a first attempt to mine the database of a popular sandbox, looking for signs of mal- ware development. Our experiments show promising re- sults. We were able to automatically identify thousands of developments, and to show how the authors modify their programs to test their functionalities or to evade de- tections from known sandboxes. Around 1,500 of them were real malware developments – some of which have been later observed on thousands of infected machines around the world.</p><p style="padding-top: 10pt;text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 6pt;text-indent: 0pt;text-align: left;">Acknowledgment</h2><p style="padding-top: 9pt;padding-left: 6pt;text-indent: 0pt;text-align: justify;">We would like to thank Claudio Guarnieri for the fruitful discussions and insights.</p><h2 style="padding-top: 4pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">References</h2><ol id="l16"><li data-list-text="[1]"><p class="s19" style="padding-top: 8pt;padding-left: 24pt;text-indent: -14pt;text-align: left;"><a href="http://jevereg.amnpardaz.com/" style=" color: black; font-family:&quot;Times New Roman&quot;, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt;" target="_blank" name="bookmark23">Amnpardaz SandBox Jevereg. </a><a href="http://jevereg.amnpardaz.com/" class="a" target="_blank">http://jevereg.amnpardaz. </a>com/<span class="s18">.</span></p></li><li data-list-text="[2]"><p class="s19" style="padding-top: 3pt;padding-left: 24pt;text-indent: -14pt;text-align: left;"><a href="http://avtracker.info/" style=" color: black; font-family:&quot;Times New Roman&quot;, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt;" target="_blank" name="bookmark24">AV Tracker. </a>http://avtracker.info/<span class="s18">.</span></p></li><li data-list-text="[3]"><p class="s19" style="padding-top: 4pt;padding-left: 24pt;text-indent: -14pt;text-align: justify;"><a href="http://camas.comodo.com/" style=" color: black; font-family:&quot;Times New Roman&quot;, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt;" target="_blank" name="bookmark25">Comodo Instant Malware Analysis. </a><a href="http://camas.comodo.com/" class="a" target="_blank">http://camas.comodo. </a>com/<span class="s18">.</span></p></li><li data-list-text="[4]"><p style="padding-top: 3pt;padding-left: 24pt;text-indent: -14pt;text-align: justify;"><a href="http://www.threattracksecurity.com/resources/sandbox-malware-analysis.aspx" style=" color: black; font-family:&quot;Times New Roman&quot;, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt;" target="_blank" name="bookmark26">ThreatTrack  Security  Public  Sandbox.    </a><a href="http://www.threattracksecurity.com/resources/sandbox-malware-analysis.aspx" target="_blank">http:</a></p><p class="s19" style="padding-left: 24pt;text-indent: 0pt;text-align: left;"><a href="http://www.threattracksecurity.com/resources/sandbox-malware-analysis.aspx" class="a" target="_blank">//www.threattracksecurity.com/resources/ </a>sandbox-malware-analysis.aspx<span class="s18">.</span></p></li><li data-list-text="[5]"><p class="s19" style="padding-top: 3pt;padding-left: 24pt;text-indent: -14pt;text-align: left;"><a href="https://www.vicheck.ca/" style=" color: black; font-family:&quot;Times New Roman&quot;, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt;" target="_blank" name="bookmark27">ViCheck. </a>https://www.vicheck.ca<span class="s18">.</span></p></li><li data-list-text="[6]"><p class="s19" style="padding-top: 4pt;padding-left: 24pt;text-indent: -14pt;text-align: justify;"><a href="http://www.xandora.net/xangui/" style=" color: black; font-family:&quot;Times New Roman&quot;, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt;" target="_blank" name="bookmark28">Xandora - Suspicious File Analyzer. </a><a href="http://www.xandora.net/xangui/" class="a" target="_blank">http://www.xandora. </a>net/xangui/<span class="s18">.</span></p></li><li data-list-text="[7]"><p class="s19" style="padding-top: 4pt;padding-left: 24pt;text-indent: -14pt;text-align: left;"><a href="https://sites.google.com/site/xxtremerat/" style=" color: black; font-family:&quot;Times New Roman&quot;, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt;" target="_blank" name="bookmark29">Xtreme RAT.   </a><a href="https://sites.google.com/site/xxtremerat/" class="a" target="_blank">https://sites.google.com/site/ </a>xxtremerat/<span class="s18">.</span></p></li><li data-list-text="[8]"><p class="s19" style="padding-top: 4pt;padding-left: 24pt;text-indent: -14pt;text-align: left;"><a href="http://www.megasecurity.org/trojans/b/bifrost/Bifrost2.0special.html" style=" color: black; font-family:&quot;Times New Roman&quot;, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt;" target="_blank" name="bookmark30">Bifrost Builder. </a><a href="http://www.megasecurity.org/trojans/b/bifrost/Bifrost2.0special.html" class="a" target="_blank">http://www.megasecurity.org/trojans/ </a>b/bifrost/Bifrost2.0special.html<span class="s18">, 2008.</span></p></li><li data-list-text="[9]"><p class="s19" style="padding-top: 3pt;padding-left: 24pt;text-indent: -14pt;text-align: left;"><a href="http://www.poisonivy-rat.com/" style=" color: black; font-family:&quot;Times New Roman&quot;, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt;" target="_blank" name="bookmark31">Poison Ivy RAT. </a>http://www.poisonivy-rat.com<span class="s18">, 2008.</span></p></li><li data-list-text="[10]"><p class="s19" style="padding-top: 3pt;padding-left: 24pt;text-indent: -18pt;text-align: left;"><a href="http://anubis.iseclab.org/" style=" color: black; font-family:&quot;Times New Roman&quot;, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt;" target="_blank" name="bookmark32">Anubis. </a>http://anubis.iseclab.org<span class="s18">, 2009.</span></p></li><li data-list-text="[11]"><p class="s19" style="padding-top: 4pt;padding-left: 24pt;text-indent: -18pt;text-align: left;"><a href="http://googleblog.blogspot.fr/2010/01/new-approach-to-china.html" style=" color: black; font-family:&quot;Times New Roman&quot;, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt;" target="_blank" name="bookmark33">A new approach to China. </a><a href="http://googleblog.blogspot.fr/2010/01/new-approach-to-china.html" class="a" target="_blank">http://googleblog.blogspot. </a>fr/2010/01/new-approach-to-china.html<span class="s18">, 2010.</span></p></li><li data-list-text="[12]"><p class="s19" style="padding-top: 3pt;padding-left: 24pt;text-indent: -18pt;text-align: left;"><a href="https://www.fbo.gov/index?s=opportunity&amp;mode=form&amp;id=c34caee99a41eb14d4ca81949d4f2fde" style=" color: black; font-family:&quot;Times New Roman&quot;, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt;" target="_blank" name="bookmark34">Darpa  Cyber  Genome  Project.    </a><a href="https://www.fbo.gov/index?s=opportunity&amp;mode=form&amp;id=c34caee99a41eb14d4ca81949d4f2fde" class="a" target="_blank">https://www. fbo.gov/index?s=opportunity&amp;mode=form&amp;id= </a>c34caee99a41eb14d4ca81949d4f2fde<span class="s18">, 2010.</span></p></li><li data-list-text="[13]"><p class="s19" style="padding-top: 3pt;padding-left: 24pt;text-indent: -18pt;text-align: left;"><a href="https://malwr.com/" style=" color: black; font-family:&quot;Times New Roman&quot;, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt;" target="_blank" name="bookmark35">Malwr. </a>https://malwr.com<span class="s18">, 2010.</span></p></li><li data-list-text="[14]"><p class="s19" style="padding-top: 3pt;padding-left: 24pt;text-indent: -18pt;text-align: left;"><a href="http://www.threatexpert.com/" style=" color: black; font-family:&quot;Times New Roman&quot;, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt;" target="_blank" name="bookmark36">ThreatExpert. </a>http://www.threatexpert.com/<span class="s18">, 2010.</span></p></li><li data-list-text="[15]"><p class="s19" style="padding-top: 3pt;padding-left: 24pt;text-indent: -18pt;text-align: left;"><a href="http://malbox.xjtu.edu.cn/" style=" color: black; font-family:&quot;Times New Roman&quot;, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt;" target="_blank" name="bookmark37">Malbox. </a>http://malbox.xjtu.edu.cn/<span class="s18">, 2011.</span></p></li><li data-list-text="[16]"><p class="s18" style="padding-top: 3pt;padding-left: 24pt;text-indent: -18pt;text-align: justify;"><a name="bookmark38">&zwnj;</a>Virustotal    +=    Behavioural    Information.</p><p class="s19" style="padding-top: 1pt;padding-left: 24pt;text-indent: 0pt;text-align: left;"><a href="http://blog.virustotal.com/2012/07/virustotal-behavioural-information.html" class="a" target="_blank">http://blog.virustotal.com/2012/07/ </a>virustotal-behavioural-information.html<span class="s18">, 2012.</span></p></li><li data-list-text="[17]"><p class="s19" style="padding-top: 3pt;padding-left: 24pt;text-indent: -18pt;text-align: justify;"><a href="https://www.securelist.com/en/blog/785/" style=" color: black; font-family:&quot;Times New Roman&quot;, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt;" target="_blank" name="bookmark39">The Red October Campaign - An Advanced Cyber Espi- onage Network Targeting Diplomatic and Government Agencies. </a>https://www.securelist.com/en/blog/785/<span class="s18">, 2013.</span></p></li><li data-list-text="[18]"><p class="s19" style="padding-top: 3pt;padding-left: 24pt;text-indent: -18pt;text-align: justify;"><a href="http://totalhash.com/" style=" color: black; font-family:&quot;Times New Roman&quot;, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt;" target="_blank" name="bookmark40">TotalHash. </a>http://totalhash.com/<span class="s18">, 2013.</span></p></li><li data-list-text="[19]"><p class="s19" style="padding-top: 4pt;padding-left: 24pt;text-indent: -18pt;text-align: justify;"><a href="http://blackshop.freeforums.org/rdg-tejon-crypter-2014-t743.html" style=" color: black; font-family:&quot;Times New Roman&quot;, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt;" target="_blank" name="bookmark41">RDG Tejon Crypter. </a><a href="http://blackshop.freeforums.org/rdg-tejon-crypter-2014-t743.html" class="a" target="_blank">http://blackshop.freeforums.org/ </a>rdg-tejon-crypter-2014-t743.html<span class="s18">, 2014.</span></p></li><li data-list-text="[20]"><p class="s19" style="padding-top: 3pt;padding-left: 24pt;text-indent: -18pt;text-align: justify;"><a href="https://www.mandiant.com/blog/tracking-malware-import-hashing/" style=" color: black; font-family:&quot;Times New Roman&quot;, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt;" target="_blank" name="bookmark42">Tracking   Malware   with   Import   Hash- ing.        </a><a href="https://www.mandiant.com/blog/tracking-malware-import-hashing/" class="a" target="_blank">https://www.mandiant.com/blog/ </a>tracking-malware-import-hashing/<span class="s18">, 2014.</span></p></li><li data-list-text="[21]"><p class="s19" style="padding-top: 4pt;padding-left: 24pt;text-indent: -18pt;text-align: justify;"><a href="http://blog.virustotal.com/2014/02/virustotal-imphash.html" style=" color: black; font-family:&quot;Times New Roman&quot;, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt;" target="_blank" name="bookmark43">VirusTotal += imphash.  </a><a href="http://blog.virustotal.com/2014/02/virustotal-imphash.html" class="a" target="_blank">http://blog.virustotal.com/ </a>2014/02/virustotal-imphash.html<span class="s18">, 2014.</span></p></li><li data-list-text="[22]"><p class="s19" style="padding-top: 3pt;padding-left: 24pt;text-indent: -18pt;text-align: left;"><a href="http://www.fireeye.com/blog/technical/2014/02/xtremerat-nuisance-or-threat.html" style=" color: black; font-family:&quot;Times New Roman&quot;, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt;" target="_blank" name="bookmark44">XtremeRAT: Nuisance or Threat?     </a><a href="http://www.fireeye.com/blog/technical/2014/02/xtremerat-nuisance-or-threat.html" class="a" target="_blank">http:// www.fireeye.com/blog/technical/2014/02/ </a>xtremerat-nuisance-or-threat.html<span class="s18">, 2014.</span></p></li><li data-list-text="[23]"><p class="s18" style="padding-top: 3pt;padding-left: 24pt;text-indent: -18pt;text-align: justify;"><a name="bookmark45">&zwnj;</a>B<span class="s20">ALZAROTTI</span>, D., C<span class="s20">OVA</span>, M., K<span class="s20">ARLBERGER</span>, C., K<span class="s20">RUEGEL</span>,</p><ol id="l17"><li data-list-text="C."><p class="s18" style="padding-left: 32pt;text-indent: -8pt;text-align: justify;">, K<span class="s20">IRDA</span>, E., <span class="s20">AND </span>V<span class="s20">IGNA</span>, G. Efficient Detection of Split Personalities in Malware. In <i>Proceedings of the Network and Distributed System Security Symposium (NDSS) </i>(San Diego, CA, February 2010), NDSS 10.</p></li></ol></li><li data-list-text="[24]"><p class="s18" style="padding-top: 4pt;padding-left: 24pt;text-indent: -18pt;text-align: justify;"><a name="bookmark46">&zwnj;</a>B<span class="s20">AYER</span>, U., H<span class="s20">ABIBI</span>, I., B<span class="s20">ALZAROTTI</span>, D., K<span class="s20">IRDA</span>, E., <span class="s20">AND</span></p><p class="s18" style="padding-left: 24pt;text-indent: 0pt;text-align: justify;">K<span class="s20">RUEGEL</span>, C. A view on current malware behaviors. In <i>USENIX workshop on large-scale exploits and emergent threats (LEET) </i>(April 2009), LEET 09.</p></li><li data-list-text="[25]"><p class="s18" style="padding-top: 4pt;padding-left: 24pt;text-indent: -18pt;text-align: justify;"><a name="bookmark47">&zwnj;</a>	B<span class="s20">ILGE</span>, L., <span class="s20">AND </span>D<span class="s20">UMITRAS</span>, T. Before we knew it: An empir- ical study of zero-day attacks in the real world. In <i>Proceedings of the 2012 ACM Conference on Computer and Communications Security </i>(New York, NY, USA, 2012), CCS ’12, ACM, pp. 833– 844.</p></li><li data-list-text="[26]"><p class="s18" style="padding-top: 8pt;padding-left: 24pt;text-indent: -18pt;text-align: justify;"><a name="bookmark48">&zwnj;</a>B<span class="s20">RUSCHI</span>, D., M<span class="s20">ARTIGNONI</span>, L., <span class="s20">AND </span>M<span class="s20">ONGA</span>, M. Using Code</p><p class="s18" style="padding-left: 24pt;text-indent: 0pt;text-align: justify;">Normalization for Fighting Self-Mutating Malware. In <i>Proceed- ings of the International Symposium of Secure Software Engi- neering (ISSSE) </i>(Mar. 2006), IEEE Computer Society. Arlington, VA, USA.</p></li><li data-list-text="[27]"><p class="s18" style="padding-top: 5pt;padding-left: 24pt;text-indent: -18pt;text-align: justify;"><a name="bookmark49">&zwnj;</a>	D<span class="s20">IXON</span><a href="http://blog.9bplus.com/watching-attackers-through-virustotal/" style=" color: black; font-family:&quot;Times New Roman&quot;, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt;" target="_blank">,  B.     Watching  attackers  through virustotal.         </a><a href="http://blog.9bplus.com/watching-attackers-through-virustotal/" class="a" target="_blank">http://blog.9bplus.com/ </a><span class="s19">watching-attackers-through-virustotal/</span>, 2014.</p></li><li data-list-text="[28]"><p class="s18" style="padding-top: 4pt;padding-left: 24pt;text-indent: -18pt;text-align: justify;"><a name="bookmark50">&zwnj;</a>	D<span class="s20">UMITRAS</span>, T., <span class="s20">AND </span>S<span class="s20">HOU</span>, D. Toward a standard benchmark for computer security research: The worldwide intelligence net- work environment (wine). In <i>Proceedings of the First Workshop on Building Analysis Datasets and Gathering Experience Returns for Security </i>(2011), BADGERS ’11.</p></li><li data-list-text="[29]"><p class="s18" style="padding-top: 4pt;padding-left: 24pt;text-indent: -18pt;text-align: justify;"><a name="bookmark51">&zwnj;</a>	F<span class="s20">LAKE</span>, H. Structural comparison of executable objects. In <i>In Proceedings of the IEEE Conference on Detection of Intru- sions and Malware &amp; Vulnerability Assessment (DIMVA </i>(2004),</p><p class="s18" style="padding-left: 24pt;text-indent: 0pt;line-height: 9pt;text-align: justify;">pp. 161–173.</p></li><li data-list-text="[30]"><p class="s18" style="padding-top: 5pt;padding-left: 24pt;text-indent: -18pt;text-align: justify;"><a name="bookmark52">&zwnj;</a>H<span class="s20">AYES</span>, M., W<span class="s20">ALENSTEIN</span>, A., <span class="s20">AND </span>L<span class="s20">AKHOTIA</span>, A. Evalua-</p><p class="s18" style="padding-left: 24pt;text-indent: 0pt;text-align: justify;">tion of malware phylogeny modelling systems using automated variant generation, 2009.</p></li><li data-list-text="[31]"><p class="s18" style="padding-top: 5pt;padding-left: 24pt;text-indent: -18pt;text-align: justify;"><a name="bookmark53">&zwnj;</a>H<span class="s20">U</span>, X., B<span class="s20">HATKAR</span>, S., G<span class="s20">RIFFIN</span>, K., <span class="s20">AND </span>S<span class="s20">HIN</span>, K. G.</p><p class="s18" style="padding-left: 24pt;text-indent: 0pt;text-align: justify;">Mutantx-s: Scalable malware clustering based on static features. In <i>Proceedings of the 2013 USENIX Conference on Annual Tech- nical Conference </i>(Berkeley, CA, USA, 2013), USENIX ATC’13, USENIX Association, pp. 187–198.</p></li><li data-list-text="[32]"><p class="s18" style="padding-top: 5pt;padding-left: 24pt;text-indent: -18pt;text-align: justify;"><a name="bookmark54">&zwnj;</a>J<span class="s20">ACOB</span>, G., C<span class="s20">OMPARETTI</span>, P. M., N<span class="s20">EUGSCHWANDTNER</span>, M.,</p><p class="s18" style="padding-left: 24pt;text-indent: 0pt;text-align: justify;">K<span class="s20">RUEGEL</span>, C., <span class="s20">AND </span>V<span class="s20">IGNA</span>, G. A static, packer-agnostic filter to detect similar malware samples. In <i>Proceedings of the 9th International Conference on Detection of Intrusions and Mal- ware, and Vulnerability Assessment </i>(Berlin, Heidelberg, 2013), DIMVA’12, Springer-Verlag, pp. 102–122.</p></li><li data-list-text="[33]"><p class="s18" style="padding-top: 4pt;padding-left: 24pt;text-indent: -18pt;text-align: justify;"><a name="bookmark55">&zwnj;</a>J<span class="s20">ANG</span>, J., B<span class="s20">RUMLEY</span>, D., <span class="s20">AND </span>V<span class="s20">ENKATARAMAN</span>, S. Bitshred:</p><p class="s18" style="padding-left: 24pt;text-indent: 0pt;text-align: justify;">Feature hashing malware for scalable triage and semantic anal- ysis. In <i>Proceedings of the 18th ACM Conference on Computer and Communications Security </i>(New York, NY, USA, 2011), CCS ’11, pp. 309–320.</p></li><li data-list-text="[34]"><p class="s18" style="padding-top: 5pt;padding-left: 24pt;text-indent: -18pt;text-align: justify;"><a name="bookmark56">&zwnj;</a>	J<span class="s20">ANG</span>, J., W<span class="s20">OO</span>, M., <span class="s20">AND </span>B<span class="s20">RUMLEY</span>, D. Towards automatic software lineage inference. In <i>Proceedings of the 22Nd USENIX Conference on Security </i>(Berkeley, CA, USA, 2013), SEC’13, USENIX Association, pp. 81–96.</p></li><li data-list-text="[35]"><p class="s18" style="padding-top: 4pt;padding-left: 24pt;text-indent: -18pt;text-align: justify;"><a name="bookmark57">&zwnj;</a>K<span class="s20">ASPERSKY   </span>GR<span class="s20">E</span>AT   T<span class="s20">EAM</span>.        Equation:</p><p style="padding-left: 24pt;text-indent: 0pt;text-align: justify;"><a href="http://securelist.com/blog/research/68750/equation-the-death-star-of-malware-galaxy/" style=" color: black; font-family:&quot;Times New Roman&quot;, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt;" target="_blank">The  death  star  of  malware  galaxy.    </a><a href="http://securelist.com/blog/research/68750/equation-the-death-star-of-malware-galaxy/" target="_blank">http:</a></p><p style="padding-left: 24pt;text-indent: 0pt;line-height: 9pt;text-align: left;"><a href="http://securelist.com/blog/research/68750/equation-the-death-star-of-malware-galaxy/">//securelist.com/blog/research/68750/</a></p><p class="s19" style="padding-left: 24pt;text-indent: 0pt;line-height: 10pt;text-align: left;">equation-the-death-star-of-malware-galaxy/<span class="s18">, 2015.</span></p></li><li data-list-text="[36]"><p class="s18" style="padding-top: 4pt;padding-left: 24pt;text-indent: -18pt;text-align: justify;"><a name="bookmark58">&zwnj;</a>	K<span class="s20">HOO</span>, W. M., <span class="s20">AND </span>L<span class="s20">IO</span>, P. Unity in diversity: Phylogenetic- inspired techniques for reverse engineering and detection of mal- ware families. <i>SysSec Workshop </i>(2011), 3–10.</p></li><li data-list-text="[37]"><p class="s18" style="padding-top: 5pt;padding-left: 24pt;text-indent: -18pt;text-align: justify;"><a name="bookmark59">&zwnj;</a>	K<span class="s20">OIVUNEN</span><a href="http://www.teamfurry.com/" style=" color: black; font-family:&quot;Times New Roman&quot;, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt;" target="_blank">, T. Sigbuster. </a><span class="s19">http://www.teamfurry.com&quot;</span>, 2009.</p></li><li data-list-text="[38]"><p class="s18" style="padding-top: 5pt;padding-left: 24pt;text-indent: -18pt;text-align: justify;"><a name="bookmark60">&zwnj;</a>	K<span class="s20">ORNBLUM</span>, J. Identifying almost identical files using context triggered piecewise hashing. <i>Digital Investigation 3, Supplement</i>, 0 (2006), 91 – 97.</p></li><li data-list-text="[39]"><p class="s18" style="padding-top: 5pt;padding-left: 24pt;text-indent: -18pt;text-align: justify;"><a name="bookmark61">&zwnj;</a>K<span class="s20">RUEGEL</span>, C., K<span class="s20">IRDA</span>, E., M<span class="s20">UTZ</span>, D., R<span class="s20">OBERTSON</span>, W., <span class="s20">AND</span></p><p class="s18" style="padding-left: 24pt;text-indent: 0pt;text-align: justify;">V<span class="s20">IGNA</span>, G. Polymorphic worm detection using structural infor- mation of executables. In <i>Proceedings of the 8th International Conference on Recent Advances in Intrusion Detection </i>(Berlin, Heidelberg, 2006), RAID’05, Springer-Verlag, pp. 207–226.</p></li><li data-list-text="[40]"><p class="s18" style="padding-top: 5pt;padding-left: 24pt;text-indent: -18pt;text-align: justify;"><a name="bookmark62">&zwnj;</a>K<span class="s20">URTZ</span>,  G.   Operation Aurora hit Google,  Others.</p><p style="padding-top: 1pt;padding-left: 24pt;text-indent: 0pt;text-align: left;"><a href="http://web.archive.org/web/20100327181927/http">http://web.archive.org/web/20100327181927/http:</a></p><p class="s19" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">//siblog.mcafee.com/cto/operation-%E2%80% 9Caurora%E2%80%9D-hit-google-others<span class="s18">, 2010.</span></p></li><li data-list-text="[41]"><p class="s18" style="padding-top: 8pt;padding-left: 24pt;text-indent: -18pt;text-align: justify;"><a name="bookmark63">&zwnj;</a>L<span class="s20">ANDWEHR</span>, N., H<span class="s20">ALL</span>, M., <span class="s20">AND </span>F<span class="s20">RANK</span>, E. Logistic model</p><p class="s18" style="padding-left: 24pt;text-indent: 0pt;text-align: justify;">trees. In <i>Machine Learning: ECML 2003 </i>(2003), Springer Berlin Heidelberg, pp. 241–252.</p></li><li data-list-text="[42]"><p class="s18" style="padding-top: 4pt;padding-left: 24pt;text-indent: -18pt;text-align: justify;"><a name="bookmark64">&zwnj;</a>	L<span class="s20">IGH</span><a href="http://www.mnin.org/?page=vmmdetect" style=" color: black; font-family:&quot;Times New Roman&quot;, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt;" target="_blank">, M. Using IDT for VMM Detection. </a><a href="http://www.mnin.org/?page=vmmdetect" class="a" target="_blank">http://www.mnin. </a><span class="s19">org/?page=vmmdetect</span>.</p></li><li data-list-text="[43]"><p class="s18" style="padding-top: 3pt;padding-left: 24pt;text-indent: -18pt;text-align: justify;"><a name="bookmark65">&zwnj;</a>L<span class="s20">INDORFER</span>,  M.,  D<span class="s20">I  </span>F<span class="s20">EDERICO</span>,  A.,  M<span class="s20">AGGI</span>,  F.,  M<span class="s20">I</span>-</p><p class="s22" style="padding-left: 24pt;text-indent: 0pt;text-align: justify;">LANI <span class="s23">C</span>OMPARETTI<span class="s23">, P., </span>AND <span class="s23">Z</span>ANERO<span class="s23">, S. Lines of Malicious Code: Insights Into the Malicious Software Industry. In </span><span class="s21">Proceed- ings of the 28th Annual Computer Security Applications Confer- ence (ACSAC) </span><span class="s18">(2012).</span></p></li><li data-list-text="[44]"><p class="s18" style="padding-top: 3pt;padding-left: 23pt;text-indent: -17pt;text-align: justify;"><a name="bookmark66">&zwnj;</a>Lindorfer, M., Kolbitsch, C., and Milani Com-</p><p class="s22" style="padding-left: 24pt;text-indent: 0pt;text-align: justify;">PARETTI<span class="s23">, P. Detecting Environment-Sensitive Malware. In </span><span class="s21">Pro- ceedings of the 14th International Conference on Recent Ad- vances in Intrusion Detection (RAID) </span><span class="s18">(2011).</span></p></li><li data-list-text="[45]"><p class="s18" style="padding-top: 3pt;padding-left: 24pt;text-indent: -18pt;text-align: left;"><a name="bookmark67">&zwnj;</a>MORGAN MARQUIS-BOIRE, CLAUDIO GUARNIERI,</p><p class="s19" style="padding-left: 24pt;text-indent: 0pt;text-align: left;"><a href="https://firstlook.org/theintercept/2014/11/24/secret-regin-malware-belgacom-nsa-gchq/" style=" color: black; font-family:&quot;Times New Roman&quot;, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt;" target="_blank">AND RYAN GALLAGHER.  Secret malware in euro- pean union attack linked to u.s. and british intelligence. </a><a href="https://firstlook.org/theintercept/2014/11/24/secret-regin-malware-belgacom-nsa-gchq/" class="a" target="_blank">https://firstlook.org/theintercept/2014/11/24/ </a>secret-regin-malware-belgacom-nsa-gchq/<span class="s18">, 2014.</span></p></li><li data-list-text="[46]"><p class="s18" style="padding-top: 3pt;padding-left: 24pt;text-indent: -18pt;text-align: left;"><a name="bookmark68">&zwnj;</a>M<span class="s20">OSER</span>, A., K<span class="s20">RUEGEL</span>, C., <span class="s20">AND </span>K<span class="s20">IRDA</span>, E. Exploring mul-</p><p class="s18" style="padding-left: 24pt;text-indent: 0pt;text-align: justify;">tiple execution paths for malware analysis. In <i>Proceedings of the 2007 IEEE Symposium on Security and Privacy </i>(Washington, DC, USA, 2007), SP ’07, IEEE Computer Society, pp. 231–245.</p></li><li data-list-text="[47]"><p class="s18" style="padding-top: 4pt;padding-left: 24pt;text-indent: -18pt;text-align: justify;"><a name="bookmark69">&zwnj;</a>	Q<span class="s20">UIST</span>, D., <span class="s20">AND </span>S<span class="s20">MITH</span><a href="http://www.offensivecomputing.net/files/active/0/vm.pdf" style=" color: black; font-family:&quot;Times New Roman&quot;, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt;" target="_blank">, V. Detecting the Presence of Vir- tualmachines Using the Local Data Table.  </a><a href="http://www.offensivecomputing.net/files/active/0/vm.pdf" class="a" target="_blank">http://www. </a><span class="s19">offensivecomputing.net/files/active/0/vm.pdf</span>.</p></li><li data-list-text="[48]"><p class="s18" style="padding-top: 3pt;padding-left: 24pt;text-indent: -18pt;text-align: left;"><a name="bookmark70">&zwnj;</a>	R<span class="s20">UTKOWSKA</span><a href="http://web.archive.org/" style=" color: black; font-family:&quot;Times New Roman&quot;, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt;" target="_blank">, J. Red Pill... or how to detect VMM using (almost) one CPU instruction. </a><a href="http://invisiblethings.org/" class="a" target="_blank">http://web.archive.org/ web/2007091102</a><span class="s19">4318/http://invisiblethings.org/ papers/redpill.html</span>, 2004.</p></li><li data-list-text="[49]"><p class="s18" style="padding-top: 3pt;padding-left: 24pt;text-indent: -18pt;text-align: left;"><a name="bookmark71">&zwnj;</a>S<span class="s20">ÆBJØRNSEN</span>, A., W<span class="s20">ILLCOCK</span>, J., P<span class="s20">ANAS</span>, T., Q<span class="s20">UINLAN</span>, D.,</p><p class="s22" style="padding-left: 24pt;text-indent: 0pt;text-align: justify;">AND <span class="s23">S</span>U<span class="s23">, Z. Detecting code clones in binary executables. In </span><span class="s21">Pro- ceedings of the Eighteenth International Symposium on Software Testing and Analysis </span><span class="s18">(2009), ISSTA ’09.</span></p></li><li data-list-text="[50]"><p class="s18" style="padding-top: 3pt;padding-left: 24pt;text-indent: -18pt;text-align: left;"><a name="bookmark72">&zwnj;</a>	S<span class="s20">YMANTEC </span>S<span class="s20">ECURITY </span>R<span class="s20">ESPONSE</span><a href="http://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/regin-analysis.pdf" style=" color: black; font-family:&quot;Times New Roman&quot;, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt;" target="_blank">. Regin: Top-tier espionage tool enables stealthy surveillance. </a><a href="http://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/regin-analysis.pdf" class="a" target="_blank">http://www.symantec. com/content/en/us/enterprise/media/security_ </a><span class="s19">response/whitepapers/regin-analysis.pdf</span>, 2014.</p></li><li data-list-text="[51]"><p class="s18" style="padding-top: 3pt;padding-left: 24pt;text-indent: -18pt;text-align: justify;"><a name="bookmark73">&zwnj;</a>	W<span class="s20">ICHERSKI</span>, G. pehash: A novel approach to fast malware clus- tering. In <i>Proceedings of the 2Nd USENIX Conference on Large- scale Exploits and Emergent Threats: Botnets, Spyware, Worms, and More </i>(Berkeley, CA, USA, 2009), LEET’09, USENIX As-</p><p class="s18" style="padding-left: 24pt;text-indent: 0pt;line-height: 9pt;text-align: justify;">sociation, pp. 1–1.</p></li><li data-list-text="[52]"><p class="s18" style="padding-top: 4pt;padding-left: 24pt;text-indent: -18pt;text-align: justify;"><a name="bookmark74">&zwnj;</a>	Z<span class="s20">ETTER</span><a href="http://www.wired.com/2014/09/how-hackers-use-virustotal/" style=" color: black; font-family:&quot;Times New Roman&quot;, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt;" target="_blank">, K. A google site meant to protect you is help- ing hackers attack you. </a><a href="http://www.wired.com/2014/09/how-hackers-use-virustotal/" class="a" target="_blank">http://www.wired.com/2014/09/ </a><span class="s19">how-hackers-use-virustotal/</span>, 2014.</p></li></ol><ol id="l18"><li data-list-text="A"><h2 style="padding-top: 4pt;padding-left: 26pt;text-indent: -20pt;text-align: left;"><a name="bookmark75">&zwnj;</a>Individual Sample Features</h2><p style="text-indent: 0pt;text-align: left;"><br/></p><h4 style="padding-left: 35pt;text-indent: 0pt;text-align: left;">A: File Features</h4><ol id="l19"><li data-list-text="A.1"><p class="s8" style="padding-top: 1pt;padding-left: 50pt;text-indent: -15pt;text-align: left;">Filename        The original name of the file submitted by the user</p></li><li data-list-text="A.2"><p class="s8" style="padding-left: 50pt;text-indent: -15pt;text-align: left;">File size        The size of the file</p></li><li data-list-text="A.3"><p class="s8" style="padding-left: 50pt;text-indent: -15pt;text-align: left;">MD5          Simple hash used for lookup in other data sources</p></li><li data-list-text="A.4"><p class="s8" style="padding-left: 50pt;text-indent: -15pt;text-align: left;">Fuzzy Hashes      Using SSDeep algorithm</p></li></ol></li></ol><h4 style="padding-top: 1pt;padding-left: 35pt;text-indent: 0pt;text-align: left;">B: Timestamps</h4><ol id="l20"><ol id="l21"><li data-list-text="B.1"><p class="s8" style="padding-top: 1pt;padding-left: 50pt;text-indent: -14pt;text-align: left;">Submission time     Time in which the sample was submitted to Anubis Sandbox</p></li><li data-list-text="B.2"><p class="s8" style="padding-left: 50pt;text-indent: -14pt;text-align: left;">Compile time      Time in which the binary was compiled</p></li><li data-list-text="B.3"><p class="s8" style="padding-left: 50pt;text-indent: -14pt;text-align: left;">Symantec first      Time the sample was first observed in the wild by Symantec</p></li><li data-list-text="B.4"><p class="s8" style="padding-left: 50pt;text-indent: -14pt;text-align: left;">VirusTotal first     Time in which the binary was first submitted to VirusTotal</p></li></ol></ol><h4 style="padding-top: 1pt;padding-left: 35pt;text-indent: 0pt;text-align: left;">C: AV Features</h4><ol id="l22"><ol id="l23"><li data-list-text="C.1"><p class="s8" style="padding-top: 1pt;padding-left: 50pt;text-indent: -14pt;text-align: left;">AV-Detection      Number of AV that flag the samples as malicious (according to VirusTotal)</p></li><li data-list-text="C.2"><p class="s8" style="padding-left: 50pt;text-indent: -14pt;text-align: left;">AV-Labels       List of AV labels associated to the sample (according to VirusTotal)</p></li></ol></ol><h4 style="padding-top: 1pt;padding-left: 35pt;text-indent: 0pt;text-align: left;">D: User-based Features</h4><ol id="l24"><ol id="l25"><li data-list-text="D.1"><p class="s8" style="padding-top: 1pt;padding-left: 50pt;text-indent: -15pt;text-align: left;">User Agent       User agent of the browser used to submit the sample</p></li><li data-list-text="D.2"><p class="s8" style="padding-left: 50pt;text-indent: -15pt;text-align: left;">Languages       Languages accepted by the user browser</p><p class="s8" style="padding-left: 148pt;text-indent: 0pt;line-height: 11pt;text-align: left;">(according to the <span class="s9">accept-language </span>HTTP header)</p></li><li data-list-text="D.3"><p class="s8" style="padding-left: 50pt;text-indent: -15pt;line-height: 10pt;text-align: left;">IP           IP address of the user who submitted the file</p></li><li data-list-text="D.4"><p class="s8" style="padding-left: 50pt;text-indent: -15pt;text-align: left;">IP Geolocation     Geolocation of the user IP address</p></li><li data-list-text="D.5"><p class="s8" style="padding-left: 50pt;text-indent: -15pt;text-align: left;">Email address      Optional email address specified when the sample was submitted</p></li><li data-list-text="D.6"><p class="s8" style="padding-left: 50pt;text-indent: -15pt;text-align: left;">Proxy          Boolean value used to identify submission through popular anonymization proxies</p></li></ol></ol><h4 style="padding-top: 1pt;padding-left: 35pt;text-indent: 0pt;text-align: left;">E: Binary Features</h4><ol id="l26"><ol id="l27"><li data-list-text="E.1"><p class="s8" style="padding-top: 1pt;padding-left: 49pt;text-indent: -14pt;text-align: left;">N.Sections       Number of sections in the PE file</p></li><li data-list-text="E.2"><p class="s8" style="padding-left: 49pt;text-indent: -14pt;text-align: left;">N.Fuctions       Number of functions identified by the disassembly</p></li><li data-list-text="E.3"><p class="s8" style="padding-left: 49pt;text-indent: -14pt;line-height: 11pt;text-align: left;">Code Coverage     Fraction of <span class="s9">.text </span>segment covered by the identified functions</p></li><li data-list-text="E.4"><p class="s8" style="padding-left: 49pt;text-indent: -14pt;line-height: 10pt;text-align: left;">Programming Language  Programming language used to develop the binary</p></li><li data-list-text="E.5"><p class="s8" style="padding-left: 49pt;text-indent: -14pt;text-align: left;">Metadata        Filenames and username extracted from the PE file</p></li></ol></ol><h4 style="padding-top: 1pt;padding-left: 35pt;text-indent: 0pt;text-align: left;">F: Behavioral Features</h4><ol id="l28"><ol id="l29"><li data-list-text="F.1"><p class="s8" style="padding-top: 1pt;padding-left: 48pt;text-indent: -13pt;text-align: left;">Duration         Duration in seconds of the analysis</p></li><li data-list-text="F.2"><p class="s8" style="padding-left: 48pt;text-indent: -13pt;text-align: left;">Errors          Error raised during the analysis</p></li><li data-list-text="F.3"><p class="s8" style="padding-left: 48pt;text-indent: -13pt;text-align: left;">Evasion         Known anti-sandbox techniques detected by the sandbox itself</p></li><li data-list-text="F.4"><p class="s8" style="padding-left: 48pt;text-indent: -13pt;text-align: left;">Behavior Bitstring    Sequence of 24 boolean flags that characterize the behavior of the sample. (<span class="s9">has popups</span>, <span class="s9">has udp traffic</span>, <span class="s9">has http</span>, <span class="s9">has tcp address scan</span>, <span class="s9">modified registry keys</span>, . . . )</p></li></ol></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: center;">Table 5: List of Individual Features associated to each sample</p></body></html>
